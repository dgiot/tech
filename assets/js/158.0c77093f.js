(window.webpackJsonp=window.webpackJsonp||[]).push([[158],{690:function(t,e,_){"use strict";_.r(e);var s=_(8),v=Object(s.a)({},(function(){var t=this,e=t.$createElement,_=t._self._c||e;return _("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[_("h1",{attrs:{id:"mqtt-代理订阅"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#mqtt-代理订阅"}},[t._v("#")]),t._v(" MQTT 代理订阅")]),t._v(" "),_("p",[t._v("EMQ X 的代理订阅功能使得客户端在连接建立时，不需要发送额外的 SUBSCRIBE 报文，便能自动建立用户预设的订阅关系。")]),t._v(" "),_("h2",{attrs:{id:"创建模块"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#创建模块"}},[t._v("#")]),t._v(" 创建模块")]),t._v(" "),_("p",[t._v("打开 "),_("a",{attrs:{href:"http://127.0.0.1:18083/#/modules",target:"_blank",rel:"noopener noreferrer"}},[t._v("EMQ X Dashboard"),_("OutboundLink")],1),t._v("，点击左侧的 “模块” 选项卡，选择添加：")]),t._v(" "),_("p",[_("img",{attrs:{src:"http://dgiot-1253666439.cos.ap-shanghai-fsi.myqcloud.com/shuwa_tech/zh/backend/emqx/modules/assets/modules.png",alt:"modules.png"}})]),t._v(" "),_("p",[t._v("选择 MQTT 代理订阅模块")]),t._v(" "),_("p",[_("img",{attrs:{src:"http://dgiot-1253666439.cos.ap-shanghai-fsi.myqcloud.com/shuwa_tech/zh/backend/emqx/modules/assets/mod_subscriptions_1.png",alt:"mod_subscriptions_1.png"}})]),t._v(" "),_("p",[t._v("配置相关参数")]),t._v(" "),_("p",[_("img",{attrs:{src:"http://dgiot-1253666439.cos.ap-shanghai-fsi.myqcloud.com/shuwa_tech/zh/backend/emqx/modules/assets/mod_subscriptions_2.png",alt:"mod_subscriptions_2.png"}})]),t._v(" "),_("p",[t._v("点击添加后，模块添加完成")]),t._v(" "),_("p",[_("img",{attrs:{src:"http://dgiot-1253666439.cos.ap-shanghai-fsi.myqcloud.com/shuwa_tech/zh/backend/emqx/modules/assets/mod_subscriptions_3.png",alt:"mod_subscriptions_3.png"}})]),t._v(" "),_("h2",{attrs:{id:"订阅选项"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#订阅选项"}},[t._v("#")]),t._v(" 订阅选项")]),t._v(" "),_("ul",[_("li",[_("p",[t._v("服务质量（ QoS ）")]),t._v(" "),_("p",[t._v("服务端可以向客户端发送的应用消息的最大 QoS 等级。")])]),t._v(" "),_("li",[_("p",[t._v("NL（ No Local ）")]),t._v(" "),_("p",[t._v("应用消息是否能够被转发到发布此消息的客户端。")]),t._v(" "),_("ul",[_("li",[_("p",[t._v("NL 值为 0 时，表示应用消息可以被转发给发布此消息的客户端。")])]),t._v(" "),_("li",[_("p",[t._v("NL 值为 1 时，表示应用消息不能被转发给发布此消息的客户端。")])])])]),t._v(" "),_("li",[_("p",[t._v("RAP（ Retain As Published ）")]),t._v(" "),_("p",[t._v("向此订阅转发应用消息时，是否保持消息被发布时设置的保留(RETAIN)标志。")]),t._v(" "),_("ul",[_("li",[_("p",[t._v("RAP 值为 0 时，表示向此订阅转发应用消息时把保留标志设置为 0。")])]),t._v(" "),_("li",[_("p",[t._v("RAP 值为 1 时，表示向此订阅转发应用消息时保持消息被发布时设置的保留标志。")])])])]),t._v(" "),_("li",[_("p",[t._v("RH（ Retain Handling ）")]),t._v(" "),_("p",[t._v("当订阅建立时，是否发送保留消息")]),t._v(" "),_("ul",[_("li",[_("p",[t._v("0：订阅建立时发送保留消息")])]),t._v(" "),_("li",[_("p",[t._v("1：订阅建立时，若该订阅当前不存在则发送保留消息")])]),t._v(" "),_("li",[_("p",[t._v("2：订阅建立时不要发送保留消息")])])])])]),t._v(" "),_("h2",{attrs:{id:"代理订阅规则"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#代理订阅规则"}},[t._v("#")]),t._v(" 代理订阅规则")]),t._v(" "),_("p",[t._v("在配置代理订阅的主题时，EMQ X 提供了 "),_("code",[t._v("%c")]),t._v(" 和 "),_("code",[t._v("%u")]),t._v(" 两个占位符供用户使用，EMQ X 会在执行代理订阅时将配置中的 "),_("code",[t._v("%c")]),t._v(" 和 "),_("code",[t._v("%u")]),t._v(" 分别替换为客户端的 "),_("code",[t._v("Client ID")]),t._v(" 和 "),_("code",[t._v("Username")]),t._v("，需要注意的是，"),_("code",[t._v("%c")]),t._v(" 和 "),_("code",[t._v("%u")]),t._v(" 必须占用一整个主题层级。")]),t._v(" "),_("p",[t._v("例如，添加上文图中的规则后：配置 A、B 两个客户端，客户端 A 的 "),_("code",[t._v("Client ID")]),t._v(" 为 "),_("code",[t._v("testclientA")]),t._v("，"),_("code",[t._v("Username")]),t._v(" 为 "),_("code",[t._v("testerA")]),t._v("，客户端 B 的 "),_("code",[t._v("Client ID")]),t._v(" 为 "),_("code",[t._v("testclientB")]),t._v("，"),_("code",[t._v("Username")]),t._v(" 为 "),_("code",[t._v("testerB")]),t._v("。")]),t._v(" "),_("p",[t._v("A 客户端使用 MQTT V3.1.1 协议连接 EMQ X，根据上文的配置规则，代理订阅功能会主动帮客户端订阅 QoS 为 1 的 "),_("code",[t._v("client/testclientA")]),t._v(" 和 QoS 为 2 的 "),_("code",[t._v("user/testerA")]),t._v(" 这两个主题，因为连接协议为 MQTT V3.1.1，所以配置中的 No Local、Retain As Published、Retain Handling 不生效。")]),t._v(" "),_("p",[t._v("B 客户端使用 MQTT V5 协议连接 EMQ X，根据上文的配置规则，代理订阅功能会主动帮客户端订阅 "),_("code",[t._v("client/testclientB")]),t._v(" 和 "),_("code",[t._v("user/testerB")]),t._v(" 这两个主题，其中 "),_("code",[t._v("client/testclientB")]),t._v(" 的订阅选项为 Qos = 1，No Local、Retain As Published、Retain Handling 均为 0；"),_("code",[t._v("user/testerB")]),t._v(" 的订阅选项为 Qos = 2、No Local = 1、Retain As Published = 1 、Retain Handling = 1。")])])}),[],!1,null,null,null);e.default=v.exports}}]);