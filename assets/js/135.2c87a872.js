(window.webpackJsonp=window.webpackJsonp||[]).push([[135],{572:function(a,s,t){"use strict";t.r(s);var e=t(10),o=Object(e.a)({},(function(){var a=this,s=a.$createElement,t=a._self._c||s;return t("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[t("h1",{attrs:{id:"kafka-消费组"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#kafka-消费组"}},[a._v("#")]),a._v(" Kafka 消费组")]),a._v(" "),t("p",[a._v("Kafka 消费组使用外部 Kafka 作为消息队列，可以从 Kafka 中消费消息转换成为 MQTT 消息发布在 emqx 中。")]),a._v(" "),t("p",[a._v("搭建 Kafka 环境，以 MacOS X 为例:")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[a._v("$ "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("wget")]),a._v(" http://apache.claz.org/kafka/2.3.1/kafka_2.12-2.3.1.tgz\n\n$ "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("tar")]),a._v(" -xzf  kafka_2.12-2.3.1.tgz\n\n$ "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("cd")]),a._v(" kafka_2.12-2.3.1\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 启动 Zookeeper")]),a._v("\n$ ./bin/zookeeper-server-start.sh config/zookeeper.properties\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 启动 Kafka")]),a._v("\n$ ./bin/kafka-server-start.sh config/server.properties\n")])])]),t("div",{staticClass:"custom-block danger"},[t("p",{staticClass:"custom-block-title"},[a._v("警告")]),a._v(" "),t("p",[a._v("Kafka消费组不支持Kafka0.9以下版本")]),a._v(" "),t("p",[a._v("创建资源之前，需要提前创建Kafka主题，不然会提示错误")])]),a._v(" "),t("p",[a._v("创建 Kafka 的主题:")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[a._v("$ ./bin/kafka-topics.sh --zookeeper localhost:2181 --replication-factor "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("1")]),a._v(" --partitions "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("1")]),a._v(" --topic testTopic --create\n")])])]),t("h2",{attrs:{id:"创建模块"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#创建模块"}},[a._v("#")]),a._v(" 创建模块")]),a._v(" "),t("p",[a._v("打开 "),t("a",{attrs:{href:"http://127.0.0.1:18083/#/modules",target:"_blank",rel:"noopener noreferrer"}},[a._v("EMQ X Dashboard"),t("OutboundLink")],1),a._v("，点击左侧的 “模块” 选项卡，选择添加：")]),a._v(" "),t("p",[t("img",{attrs:{src:"http://dgiot-1253666439.cos.ap-shanghai-fsi.myqcloud.com/develop_png/zh_CN/modules/assets/modules.png",alt:"modules.png"}})]),a._v(" "),t("p",[a._v("选择 Kafka 消费组模块:")]),a._v(" "),t("p",[t("img",{attrs:{src:"http://dgiot-1253666439.cos.ap-shanghai-fsi.myqcloud.com/develop_png/zh_CN/modules/assets/kafka_consumer1.png",alt:"kafka_consumer1.png"}})]),a._v(" "),t("p",[a._v("填写相关参数:")]),a._v(" "),t("p",[t("img",{attrs:{src:"http://dgiot-1253666439.cos.ap-shanghai-fsi.myqcloud.com/develop_png/zh_CN/modules/assets/kafka_consumer3.png",alt:"kafka_consumer3.png"}})]),a._v(" "),t("p",[a._v("1). Kafka 服务器地址")]),a._v(" "),t("p",[a._v("2). Kafka consumer 连接池大小")]),a._v(" "),t("p",[a._v("3). Kafka 的订阅主题")]),a._v(" "),t("p",[a._v("4). MQTT 的消息主题")]),a._v(" "),t("p",[a._v("5). MQTT 的主题服务质量")]),a._v(" "),t("p",[a._v("6). Kafka Max Bytes (每次从 Kafka 里消费消息的最大字节数)")]),a._v(" "),t("p",[a._v("7). Kafka Offset Reset Policy (重置Offset策略,reset_to_latest | reset_by_subdcriber)")]),a._v(" "),t("p",[a._v("7). Kafka consumer 是否重连")]),a._v(" "),t("p",[a._v("点击添加后，模块添加完成:")]),a._v(" "),t("p",[t("img",{attrs:{src:"http://dgiot-1253666439.cos.ap-shanghai-fsi.myqcloud.com/develop_png/zh_CN/modules/assets/kafka_consumer4.png",alt:"kafka_consumer4.png"}})]),a._v(" "),t("p",[a._v('资源已经创建完成，现在用Dashboard的websocket工具订阅MQTT的主题 "TestTopic":')]),a._v(" "),t("p",[t("img",{attrs:{src:"http://dgiot-1253666439.cos.ap-shanghai-fsi.myqcloud.com/develop_png/zh_CN/modules/assets/kafka_consumer6.png",alt:"kafka_consumer6.png"}})]),a._v(" "),t("p",[a._v("使用kafka 命令行 生产一条消息:")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[a._v("./bin/kafka-console-producer.sh --broker-list localhost:9092 --topic TestTopic\n")])])]),t("p",[t("img",{attrs:{src:"http://dgiot-1253666439.cos.ap-shanghai-fsi.myqcloud.com/develop_png/zh_CN/modules/assets/kafka_consumer6.png",alt:"kafka_consumer6.png"}})]),a._v(" "),t("p",[a._v('Dashboard的websocket工具接收到了Kafka 生产的消息"hello-kafka":')]),a._v(" "),t("p",[t("img",{attrs:{src:"http://dgiot-1253666439.cos.ap-shanghai-fsi.myqcloud.com/develop_png/zh_CN/modules/assets/kafka_consumer7.png",alt:"kafka_consumer7.png"}})])])}),[],!1,null,null,null);s.default=o.exports}}]);