<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>消息重传 | 数蛙技术团队</title>
    <meta name="generator" content="VuePress 1.8.0">
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.slim.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.2/jquery.fancybox.min.js"></script>
    <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.2/jquery.fancybox.min.css">
    <meta name="description" content="数蛙科技是一家致力于提供物联网垂直领域应用使能平台及解决方案的创新型公司。">
    <meta name="referrer" content="never">
    
    <link rel="preload" href="/assets/css/0.styles.b385f251.css" as="style"><link rel="preload" href="/assets/js/app.dd8e618a.js" as="script"><link rel="preload" href="/assets/js/6.a55563ee.js" as="script"><link rel="preload" href="/assets/js/5.451ad62b.js" as="script"><link rel="preload" href="/assets/js/74.c3b58433.js" as="script"><link rel="prefetch" href="/assets/js/10.0db4cc8a.js"><link rel="prefetch" href="/assets/js/100.3366d075.js"><link rel="prefetch" href="/assets/js/101.4fce0856.js"><link rel="prefetch" href="/assets/js/102.de2f0f25.js"><link rel="prefetch" href="/assets/js/103.98144198.js"><link rel="prefetch" href="/assets/js/104.bc444660.js"><link rel="prefetch" href="/assets/js/105.a69714df.js"><link rel="prefetch" href="/assets/js/106.6384d908.js"><link rel="prefetch" href="/assets/js/107.68b36b5e.js"><link rel="prefetch" href="/assets/js/108.e2285fcd.js"><link rel="prefetch" href="/assets/js/109.5ddf27c5.js"><link rel="prefetch" href="/assets/js/11.1811be51.js"><link rel="prefetch" href="/assets/js/110.884d863c.js"><link rel="prefetch" href="/assets/js/111.a5b75bb4.js"><link rel="prefetch" href="/assets/js/112.6df7efd4.js"><link rel="prefetch" href="/assets/js/113.d69dc865.js"><link rel="prefetch" href="/assets/js/114.26961091.js"><link rel="prefetch" href="/assets/js/115.8f85f934.js"><link rel="prefetch" href="/assets/js/116.69558966.js"><link rel="prefetch" href="/assets/js/117.befa7ff1.js"><link rel="prefetch" href="/assets/js/118.7dad8b60.js"><link rel="prefetch" href="/assets/js/119.24ad1743.js"><link rel="prefetch" href="/assets/js/12.881d7fae.js"><link rel="prefetch" href="/assets/js/120.76a1656e.js"><link rel="prefetch" href="/assets/js/121.295b7d3e.js"><link rel="prefetch" href="/assets/js/122.b966c950.js"><link rel="prefetch" href="/assets/js/123.14729a97.js"><link rel="prefetch" href="/assets/js/124.523b5d88.js"><link rel="prefetch" href="/assets/js/125.2b620cf3.js"><link rel="prefetch" href="/assets/js/126.7af5af85.js"><link rel="prefetch" href="/assets/js/127.f87ab72c.js"><link rel="prefetch" href="/assets/js/128.8fd2ef7f.js"><link rel="prefetch" href="/assets/js/129.94c7ceb1.js"><link rel="prefetch" href="/assets/js/13.48a76885.js"><link rel="prefetch" href="/assets/js/130.fd38d8cb.js"><link rel="prefetch" href="/assets/js/131.a961e420.js"><link rel="prefetch" href="/assets/js/132.9eae3dd1.js"><link rel="prefetch" href="/assets/js/133.40c5cca9.js"><link rel="prefetch" href="/assets/js/134.d6f82d9f.js"><link rel="prefetch" href="/assets/js/135.a9b61853.js"><link rel="prefetch" href="/assets/js/136.a6163f02.js"><link rel="prefetch" href="/assets/js/137.02de7606.js"><link rel="prefetch" href="/assets/js/138.cf1be4b1.js"><link rel="prefetch" href="/assets/js/139.8c1d0b26.js"><link rel="prefetch" href="/assets/js/14.5adcb951.js"><link rel="prefetch" href="/assets/js/140.eabf6761.js"><link rel="prefetch" href="/assets/js/141.5e6101ce.js"><link rel="prefetch" href="/assets/js/142.e2937e55.js"><link rel="prefetch" href="/assets/js/143.eee124d6.js"><link rel="prefetch" href="/assets/js/144.ebda1099.js"><link rel="prefetch" href="/assets/js/145.912f67a6.js"><link rel="prefetch" href="/assets/js/146.0cecc135.js"><link rel="prefetch" href="/assets/js/147.56258ebe.js"><link rel="prefetch" href="/assets/js/148.66bcb6e7.js"><link rel="prefetch" href="/assets/js/149.6dd55291.js"><link rel="prefetch" href="/assets/js/15.555f758f.js"><link rel="prefetch" href="/assets/js/150.3b10a0ab.js"><link rel="prefetch" href="/assets/js/151.5ba8aec6.js"><link rel="prefetch" href="/assets/js/152.92585fbf.js"><link rel="prefetch" href="/assets/js/153.97d7a8f1.js"><link rel="prefetch" href="/assets/js/154.6b40a747.js"><link rel="prefetch" href="/assets/js/155.0ebd9d60.js"><link rel="prefetch" href="/assets/js/156.b59e89be.js"><link rel="prefetch" href="/assets/js/157.feba1ed3.js"><link rel="prefetch" href="/assets/js/158.03bb4fdb.js"><link rel="prefetch" href="/assets/js/159.baa94a42.js"><link rel="prefetch" href="/assets/js/16.7b25e764.js"><link rel="prefetch" href="/assets/js/160.118bb77c.js"><link rel="prefetch" href="/assets/js/161.0cbf77a1.js"><link rel="prefetch" href="/assets/js/162.19e7a0dd.js"><link rel="prefetch" href="/assets/js/163.eec70d14.js"><link rel="prefetch" href="/assets/js/164.d9042742.js"><link rel="prefetch" href="/assets/js/165.d568b4be.js"><link rel="prefetch" href="/assets/js/166.b11e5651.js"><link rel="prefetch" href="/assets/js/167.8d3aa34a.js"><link rel="prefetch" href="/assets/js/168.29b73c34.js"><link rel="prefetch" href="/assets/js/169.d8f44263.js"><link rel="prefetch" href="/assets/js/17.7c1bca58.js"><link rel="prefetch" href="/assets/js/170.cdab47c2.js"><link rel="prefetch" href="/assets/js/171.63ae7719.js"><link rel="prefetch" href="/assets/js/172.da496894.js"><link rel="prefetch" href="/assets/js/173.a91e4d0d.js"><link rel="prefetch" href="/assets/js/174.d3b82bee.js"><link rel="prefetch" href="/assets/js/175.7c3ac2b9.js"><link rel="prefetch" href="/assets/js/176.5c973da8.js"><link rel="prefetch" href="/assets/js/177.75b9d13a.js"><link rel="prefetch" href="/assets/js/178.b2766b3d.js"><link rel="prefetch" href="/assets/js/179.c0e01406.js"><link rel="prefetch" href="/assets/js/18.c5a71682.js"><link rel="prefetch" href="/assets/js/180.813365e2.js"><link rel="prefetch" href="/assets/js/181.76aaf2f5.js"><link rel="prefetch" href="/assets/js/182.70790b06.js"><link rel="prefetch" href="/assets/js/183.3c93a594.js"><link rel="prefetch" href="/assets/js/184.6bf5cccb.js"><link rel="prefetch" href="/assets/js/185.9a145120.js"><link rel="prefetch" href="/assets/js/186.ef9cc96d.js"><link rel="prefetch" href="/assets/js/187.f745a7ac.js"><link rel="prefetch" href="/assets/js/188.06b39d03.js"><link rel="prefetch" href="/assets/js/189.37a0bcef.js"><link rel="prefetch" href="/assets/js/19.49dc6f4e.js"><link rel="prefetch" href="/assets/js/190.a2fab0c4.js"><link rel="prefetch" href="/assets/js/191.62602057.js"><link rel="prefetch" href="/assets/js/192.56fca153.js"><link rel="prefetch" href="/assets/js/193.7c341797.js"><link rel="prefetch" href="/assets/js/194.14796dac.js"><link rel="prefetch" href="/assets/js/195.ed9fe138.js"><link rel="prefetch" href="/assets/js/196.bdf83dd7.js"><link rel="prefetch" href="/assets/js/197.42c9af28.js"><link rel="prefetch" href="/assets/js/198.31bf101f.js"><link rel="prefetch" href="/assets/js/199.995796f0.js"><link rel="prefetch" href="/assets/js/20.ca8c09fd.js"><link rel="prefetch" href="/assets/js/200.53470b90.js"><link rel="prefetch" href="/assets/js/201.b9afb5aa.js"><link rel="prefetch" href="/assets/js/202.8be8d4d6.js"><link rel="prefetch" href="/assets/js/203.1d501e15.js"><link rel="prefetch" href="/assets/js/204.111be892.js"><link rel="prefetch" href="/assets/js/205.5156da27.js"><link rel="prefetch" href="/assets/js/206.46c5434a.js"><link rel="prefetch" href="/assets/js/207.a470893a.js"><link rel="prefetch" href="/assets/js/208.2daf5ad6.js"><link rel="prefetch" href="/assets/js/209.8c06cf94.js"><link rel="prefetch" href="/assets/js/21.6cbc6080.js"><link rel="prefetch" href="/assets/js/210.052f9233.js"><link rel="prefetch" href="/assets/js/211.0a70ee88.js"><link rel="prefetch" href="/assets/js/212.42a64f28.js"><link rel="prefetch" href="/assets/js/213.b3ae0ac5.js"><link rel="prefetch" href="/assets/js/214.552c7b81.js"><link rel="prefetch" href="/assets/js/215.d3967e5e.js"><link rel="prefetch" href="/assets/js/216.0ceafa98.js"><link rel="prefetch" href="/assets/js/217.2322f462.js"><link rel="prefetch" href="/assets/js/218.24324a7d.js"><link rel="prefetch" href="/assets/js/219.fd75a30c.js"><link rel="prefetch" href="/assets/js/22.d82eeb2a.js"><link rel="prefetch" href="/assets/js/220.9b1680dc.js"><link rel="prefetch" href="/assets/js/221.c350b216.js"><link rel="prefetch" href="/assets/js/222.5b7b6e2a.js"><link rel="prefetch" href="/assets/js/223.aebb8a4c.js"><link rel="prefetch" href="/assets/js/224.399c5a8a.js"><link rel="prefetch" href="/assets/js/225.a3abda3e.js"><link rel="prefetch" href="/assets/js/226.6ef48fa9.js"><link rel="prefetch" href="/assets/js/227.fddbcbf7.js"><link rel="prefetch" href="/assets/js/228.26bd0eb2.js"><link rel="prefetch" href="/assets/js/229.90924bc2.js"><link rel="prefetch" href="/assets/js/23.e1890205.js"><link rel="prefetch" href="/assets/js/230.69bab1b3.js"><link rel="prefetch" href="/assets/js/231.4d780dca.js"><link rel="prefetch" href="/assets/js/232.049e2aff.js"><link rel="prefetch" href="/assets/js/233.a87b8b55.js"><link rel="prefetch" href="/assets/js/234.720d705a.js"><link rel="prefetch" href="/assets/js/235.d0a8aad7.js"><link rel="prefetch" href="/assets/js/236.b59d298f.js"><link rel="prefetch" href="/assets/js/237.bbfaaa97.js"><link rel="prefetch" href="/assets/js/238.de4a3c89.js"><link rel="prefetch" href="/assets/js/239.646a26a6.js"><link rel="prefetch" href="/assets/js/24.98f99636.js"><link rel="prefetch" href="/assets/js/240.17d6b913.js"><link rel="prefetch" href="/assets/js/241.79b191e2.js"><link rel="prefetch" href="/assets/js/242.dc56df9d.js"><link rel="prefetch" href="/assets/js/243.588de244.js"><link rel="prefetch" href="/assets/js/244.96a43a58.js"><link rel="prefetch" href="/assets/js/245.3d0b26fb.js"><link rel="prefetch" href="/assets/js/246.9ec7ce2a.js"><link rel="prefetch" href="/assets/js/247.5fef1b66.js"><link rel="prefetch" href="/assets/js/248.0f884d0c.js"><link rel="prefetch" href="/assets/js/249.7b22b50b.js"><link rel="prefetch" href="/assets/js/25.27947334.js"><link rel="prefetch" href="/assets/js/250.5cc3b80c.js"><link rel="prefetch" href="/assets/js/251.51804157.js"><link rel="prefetch" href="/assets/js/252.adeb027b.js"><link rel="prefetch" href="/assets/js/253.75a3760e.js"><link rel="prefetch" href="/assets/js/254.0a02ec1d.js"><link rel="prefetch" href="/assets/js/255.9a1d67e6.js"><link rel="prefetch" href="/assets/js/256.625e70ff.js"><link rel="prefetch" href="/assets/js/257.28a538d6.js"><link rel="prefetch" href="/assets/js/258.b49a9fe9.js"><link rel="prefetch" href="/assets/js/259.e09d66cc.js"><link rel="prefetch" href="/assets/js/26.093b361a.js"><link rel="prefetch" href="/assets/js/260.10bd8cc3.js"><link rel="prefetch" href="/assets/js/261.68da81e2.js"><link rel="prefetch" href="/assets/js/262.c400369d.js"><link rel="prefetch" href="/assets/js/263.41a6334d.js"><link rel="prefetch" href="/assets/js/264.4f81e852.js"><link rel="prefetch" href="/assets/js/265.de006780.js"><link rel="prefetch" href="/assets/js/266.275effe5.js"><link rel="prefetch" href="/assets/js/267.9d9dee70.js"><link rel="prefetch" href="/assets/js/268.6b046cf2.js"><link rel="prefetch" href="/assets/js/269.2435a7f0.js"><link rel="prefetch" href="/assets/js/27.d1d9a65c.js"><link rel="prefetch" href="/assets/js/270.3d7c84fe.js"><link rel="prefetch" href="/assets/js/271.b9118960.js"><link rel="prefetch" href="/assets/js/272.2ad23de3.js"><link rel="prefetch" href="/assets/js/273.7c54bbd7.js"><link rel="prefetch" href="/assets/js/274.548bae3a.js"><link rel="prefetch" href="/assets/js/275.95dcd483.js"><link rel="prefetch" href="/assets/js/276.7d5841c5.js"><link rel="prefetch" href="/assets/js/277.de853ea6.js"><link rel="prefetch" href="/assets/js/278.f8766845.js"><link rel="prefetch" href="/assets/js/279.f3fb2abf.js"><link rel="prefetch" href="/assets/js/28.60c76efe.js"><link rel="prefetch" href="/assets/js/280.f4474ab2.js"><link rel="prefetch" href="/assets/js/281.5df677e5.js"><link rel="prefetch" href="/assets/js/282.8bf27f66.js"><link rel="prefetch" href="/assets/js/283.f1bfcd4d.js"><link rel="prefetch" href="/assets/js/284.8817b097.js"><link rel="prefetch" href="/assets/js/285.2d1a7e58.js"><link rel="prefetch" href="/assets/js/286.a5dc57a4.js"><link rel="prefetch" href="/assets/js/287.32707a88.js"><link rel="prefetch" href="/assets/js/288.49844eac.js"><link rel="prefetch" href="/assets/js/289.1332ed4c.js"><link rel="prefetch" href="/assets/js/29.79d3781d.js"><link rel="prefetch" href="/assets/js/290.b3636caf.js"><link rel="prefetch" href="/assets/js/291.6b2ae5a4.js"><link rel="prefetch" href="/assets/js/292.1f0af48a.js"><link rel="prefetch" href="/assets/js/293.0bfc2995.js"><link rel="prefetch" href="/assets/js/294.b999df66.js"><link rel="prefetch" href="/assets/js/295.4de9a35c.js"><link rel="prefetch" href="/assets/js/296.a85babb0.js"><link rel="prefetch" href="/assets/js/297.18ba954e.js"><link rel="prefetch" href="/assets/js/298.9efb3c92.js"><link rel="prefetch" href="/assets/js/299.4d2be2be.js"><link rel="prefetch" href="/assets/js/30.592629bd.js"><link rel="prefetch" href="/assets/js/300.48d801f6.js"><link rel="prefetch" href="/assets/js/301.2b10f1ed.js"><link rel="prefetch" href="/assets/js/302.87d252e3.js"><link rel="prefetch" href="/assets/js/303.f0af7830.js"><link rel="prefetch" href="/assets/js/304.23d307a3.js"><link rel="prefetch" href="/assets/js/305.31c95c58.js"><link rel="prefetch" href="/assets/js/306.71aa93ed.js"><link rel="prefetch" href="/assets/js/307.9cfce465.js"><link rel="prefetch" href="/assets/js/308.d41734d4.js"><link rel="prefetch" href="/assets/js/309.d95d3e88.js"><link rel="prefetch" href="/assets/js/31.c5892646.js"><link rel="prefetch" href="/assets/js/310.149ddd96.js"><link rel="prefetch" href="/assets/js/311.e1e0f0d3.js"><link rel="prefetch" href="/assets/js/312.7e165528.js"><link rel="prefetch" href="/assets/js/313.c2f5e7ba.js"><link rel="prefetch" href="/assets/js/314.8e4eade8.js"><link rel="prefetch" href="/assets/js/315.929b03f6.js"><link rel="prefetch" href="/assets/js/316.295891e3.js"><link rel="prefetch" href="/assets/js/317.f3210f69.js"><link rel="prefetch" href="/assets/js/318.31f2a0dd.js"><link rel="prefetch" href="/assets/js/319.ed00fbf0.js"><link rel="prefetch" href="/assets/js/32.3f688780.js"><link rel="prefetch" href="/assets/js/320.9490ba92.js"><link rel="prefetch" href="/assets/js/321.211a35e4.js"><link rel="prefetch" href="/assets/js/322.bc65e81a.js"><link rel="prefetch" href="/assets/js/323.b763ba14.js"><link rel="prefetch" href="/assets/js/324.b4975035.js"><link rel="prefetch" href="/assets/js/325.8f3b6318.js"><link rel="prefetch" href="/assets/js/326.ab1f7338.js"><link rel="prefetch" href="/assets/js/327.e4872498.js"><link rel="prefetch" href="/assets/js/328.64870697.js"><link rel="prefetch" href="/assets/js/329.80a6dfaf.js"><link rel="prefetch" href="/assets/js/33.9c7f0146.js"><link rel="prefetch" href="/assets/js/330.7ba2b248.js"><link rel="prefetch" href="/assets/js/331.450a506d.js"><link rel="prefetch" href="/assets/js/332.a3ca5ca5.js"><link rel="prefetch" href="/assets/js/333.1494c093.js"><link rel="prefetch" href="/assets/js/334.1351945c.js"><link rel="prefetch" href="/assets/js/335.cafb0ec0.js"><link rel="prefetch" href="/assets/js/336.4ccaa421.js"><link rel="prefetch" href="/assets/js/337.5d4beddf.js"><link rel="prefetch" href="/assets/js/338.83f02117.js"><link rel="prefetch" href="/assets/js/339.040051fc.js"><link rel="prefetch" href="/assets/js/34.7a6b9249.js"><link rel="prefetch" href="/assets/js/340.660e2f86.js"><link rel="prefetch" href="/assets/js/341.cd6f30db.js"><link rel="prefetch" href="/assets/js/342.22171c35.js"><link rel="prefetch" href="/assets/js/343.4f6a25f8.js"><link rel="prefetch" href="/assets/js/344.19e97d42.js"><link rel="prefetch" href="/assets/js/345.b11ed733.js"><link rel="prefetch" href="/assets/js/346.e7dcb9d2.js"><link rel="prefetch" href="/assets/js/347.9c65a0ac.js"><link rel="prefetch" href="/assets/js/348.7f68fa8c.js"><link rel="prefetch" href="/assets/js/349.510967cf.js"><link rel="prefetch" href="/assets/js/35.87701912.js"><link rel="prefetch" href="/assets/js/350.0149d3c5.js"><link rel="prefetch" href="/assets/js/351.719c9e47.js"><link rel="prefetch" href="/assets/js/352.9d37430b.js"><link rel="prefetch" href="/assets/js/353.56d3c43b.js"><link rel="prefetch" href="/assets/js/354.0fb1c09c.js"><link rel="prefetch" href="/assets/js/355.17bda86a.js"><link rel="prefetch" href="/assets/js/356.0ad658f2.js"><link rel="prefetch" href="/assets/js/357.c175e7bc.js"><link rel="prefetch" href="/assets/js/358.9519f733.js"><link rel="prefetch" href="/assets/js/359.05ac25ef.js"><link rel="prefetch" href="/assets/js/36.8009844d.js"><link rel="prefetch" href="/assets/js/360.efc78fc0.js"><link rel="prefetch" href="/assets/js/361.fb300640.js"><link rel="prefetch" href="/assets/js/362.3cc99662.js"><link rel="prefetch" href="/assets/js/363.e0117a50.js"><link rel="prefetch" href="/assets/js/364.43d159bc.js"><link rel="prefetch" href="/assets/js/365.fe25b9c8.js"><link rel="prefetch" href="/assets/js/366.229d673f.js"><link rel="prefetch" href="/assets/js/367.1adc9777.js"><link rel="prefetch" href="/assets/js/368.b0b89903.js"><link rel="prefetch" href="/assets/js/369.62563841.js"><link rel="prefetch" href="/assets/js/37.d1f17dcc.js"><link rel="prefetch" href="/assets/js/370.e99fd135.js"><link rel="prefetch" href="/assets/js/371.87c08a86.js"><link rel="prefetch" href="/assets/js/372.b0d38c6d.js"><link rel="prefetch" href="/assets/js/373.df4ce5c6.js"><link rel="prefetch" href="/assets/js/374.a5816f43.js"><link rel="prefetch" href="/assets/js/375.f889d0bd.js"><link rel="prefetch" href="/assets/js/376.eb9ec2c3.js"><link rel="prefetch" href="/assets/js/377.70d8e173.js"><link rel="prefetch" href="/assets/js/378.d8b87f58.js"><link rel="prefetch" href="/assets/js/379.67ed6819.js"><link rel="prefetch" href="/assets/js/38.58b6efb3.js"><link rel="prefetch" href="/assets/js/380.8a05b82c.js"><link rel="prefetch" href="/assets/js/381.d53dec80.js"><link rel="prefetch" href="/assets/js/382.1d81b16d.js"><link rel="prefetch" href="/assets/js/383.014302eb.js"><link rel="prefetch" href="/assets/js/384.78467766.js"><link rel="prefetch" href="/assets/js/385.4dad4ae1.js"><link rel="prefetch" href="/assets/js/386.77706365.js"><link rel="prefetch" href="/assets/js/387.f834466e.js"><link rel="prefetch" href="/assets/js/388.ea495a83.js"><link rel="prefetch" href="/assets/js/389.9cafb196.js"><link rel="prefetch" href="/assets/js/39.41833791.js"><link rel="prefetch" href="/assets/js/390.54ff43e3.js"><link rel="prefetch" href="/assets/js/391.2e068d8b.js"><link rel="prefetch" href="/assets/js/392.1868df34.js"><link rel="prefetch" href="/assets/js/393.08599129.js"><link rel="prefetch" href="/assets/js/394.7b10b68b.js"><link rel="prefetch" href="/assets/js/395.59c204c1.js"><link rel="prefetch" href="/assets/js/396.67bfb52d.js"><link rel="prefetch" href="/assets/js/397.fd316375.js"><link rel="prefetch" href="/assets/js/398.2f5a7d24.js"><link rel="prefetch" href="/assets/js/399.7b2e2e0e.js"><link rel="prefetch" href="/assets/js/40.6dce3d8a.js"><link rel="prefetch" href="/assets/js/400.a24b2146.js"><link rel="prefetch" href="/assets/js/401.951e7b5e.js"><link rel="prefetch" href="/assets/js/402.42dc521e.js"><link rel="prefetch" href="/assets/js/403.35d3295b.js"><link rel="prefetch" href="/assets/js/404.3ed84af2.js"><link rel="prefetch" href="/assets/js/405.749f8426.js"><link rel="prefetch" href="/assets/js/406.f892f678.js"><link rel="prefetch" href="/assets/js/407.5db92d24.js"><link rel="prefetch" href="/assets/js/408.9c91fe24.js"><link rel="prefetch" href="/assets/js/409.23f66955.js"><link rel="prefetch" href="/assets/js/41.a069c92f.js"><link rel="prefetch" href="/assets/js/410.6dc43688.js"><link rel="prefetch" href="/assets/js/411.b362c6da.js"><link rel="prefetch" href="/assets/js/412.605c0865.js"><link rel="prefetch" href="/assets/js/42.5b3db784.js"><link rel="prefetch" href="/assets/js/43.3b8fb396.js"><link rel="prefetch" href="/assets/js/44.8d6040bb.js"><link rel="prefetch" href="/assets/js/45.3960b81e.js"><link rel="prefetch" href="/assets/js/46.5e4797af.js"><link rel="prefetch" href="/assets/js/47.0f2d3965.js"><link rel="prefetch" href="/assets/js/48.e0b24bc3.js"><link rel="prefetch" href="/assets/js/49.23577bfe.js"><link rel="prefetch" href="/assets/js/50.0d95b5ca.js"><link rel="prefetch" href="/assets/js/51.dc32f705.js"><link rel="prefetch" href="/assets/js/52.0e7494f8.js"><link rel="prefetch" href="/assets/js/53.3efee1fe.js"><link rel="prefetch" href="/assets/js/54.6d9e37b3.js"><link rel="prefetch" href="/assets/js/55.abc056d6.js"><link rel="prefetch" href="/assets/js/56.8b56cf5b.js"><link rel="prefetch" href="/assets/js/57.92de23a9.js"><link rel="prefetch" href="/assets/js/58.89f7f97c.js"><link rel="prefetch" href="/assets/js/59.45f55527.js"><link rel="prefetch" href="/assets/js/60.7370f339.js"><link rel="prefetch" href="/assets/js/61.09094773.js"><link rel="prefetch" href="/assets/js/62.648a867c.js"><link rel="prefetch" href="/assets/js/63.94ca7774.js"><link rel="prefetch" href="/assets/js/64.47851938.js"><link rel="prefetch" href="/assets/js/65.eec48319.js"><link rel="prefetch" href="/assets/js/66.c3092327.js"><link rel="prefetch" href="/assets/js/67.3862e39c.js"><link rel="prefetch" href="/assets/js/68.78ea2bb4.js"><link rel="prefetch" href="/assets/js/69.5cb3e9bd.js"><link rel="prefetch" href="/assets/js/7.dc10d321.js"><link rel="prefetch" href="/assets/js/70.f05dfdf9.js"><link rel="prefetch" href="/assets/js/71.6ee2a25c.js"><link rel="prefetch" href="/assets/js/72.ea411a26.js"><link rel="prefetch" href="/assets/js/73.d695eee7.js"><link rel="prefetch" href="/assets/js/75.d6ef1b41.js"><link rel="prefetch" href="/assets/js/76.cc3de10e.js"><link rel="prefetch" href="/assets/js/77.f7ae1c0f.js"><link rel="prefetch" href="/assets/js/78.fb91a7d3.js"><link rel="prefetch" href="/assets/js/79.78aa8ada.js"><link rel="prefetch" href="/assets/js/8.2a984993.js"><link rel="prefetch" href="/assets/js/80.f1016b5d.js"><link rel="prefetch" href="/assets/js/81.30d77ad9.js"><link rel="prefetch" href="/assets/js/82.58334ed5.js"><link rel="prefetch" href="/assets/js/83.92c86b43.js"><link rel="prefetch" href="/assets/js/84.c09e081b.js"><link rel="prefetch" href="/assets/js/85.71b53729.js"><link rel="prefetch" href="/assets/js/86.ca46fac7.js"><link rel="prefetch" href="/assets/js/87.cb3090ad.js"><link rel="prefetch" href="/assets/js/88.22bb87c3.js"><link rel="prefetch" href="/assets/js/89.e5e739b2.js"><link rel="prefetch" href="/assets/js/9.91fa7416.js"><link rel="prefetch" href="/assets/js/90.1f2a0293.js"><link rel="prefetch" href="/assets/js/91.06e232d1.js"><link rel="prefetch" href="/assets/js/92.01df63aa.js"><link rel="prefetch" href="/assets/js/93.088d7806.js"><link rel="prefetch" href="/assets/js/94.e238fd77.js"><link rel="prefetch" href="/assets/js/95.baa3be79.js"><link rel="prefetch" href="/assets/js/96.1e504b27.js"><link rel="prefetch" href="/assets/js/97.92e326c7.js"><link rel="prefetch" href="/assets/js/98.fa841ad1.js"><link rel="prefetch" href="/assets/js/99.70f0fbb5.js"><link rel="prefetch" href="/assets/js/vendors~docsearch.8e8500d6.js"><link rel="prefetch" href="/assets/js/vendors~flowchart.66e22ccc.js"><link rel="prefetch" href="/assets/js/vendors~photo-swipe.996f273a.js">
    <link rel="stylesheet" href="/assets/css/0.styles.b385f251.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">数蛙技术团队</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="用户手册" class="dropdown-title"><span class="title">用户手册</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/zh/manual/cloud/" class="nav-link">数蛙工业数据云平台</a></li><li class="dropdown-item"><!----> <a href="/zh/manual/edge/" class="nav-link">数蛙工业边缘网关</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="产品说明" class="dropdown-title"><span class="title">产品说明</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/zh/product/dgiot/" class="nav-link">一站式物联网平台</a></li><li class="dropdown-item"><!----> <a href="/zh/product/dgtest/" class="nav-link">一站式云压测平台</a></li><li class="dropdown-item"><!----> <a href="/zh/product/dgii/" class="nav-link">工业互联网平台</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="开发指南" class="dropdown-title"><span class="title">开发指南</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/zh/backend/" class="nav-link router-link-active">服务架构</a></li><li class="dropdown-item"><!----> <a href="/zh/frontend/" class="nav-link">交互技术</a></li><li class="dropdown-item"><!----> <a href="/zh/dataanalysis/" class="nav-link">数据分析</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="实战教程" class="dropdown-title"><span class="title">实战教程</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/zh/blog/" class="nav-link">实战教程</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Select language" class="dropdown-title"><span class="title">选择语言</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/zh/backend/emqx/advanced/retransmission.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">简体中文</a></li><li class="dropdown-item"><!----> <a href="/en/" class="nav-link">English</a></li></ul></div></div> <a href="https://github.com/dgiot" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="用户手册" class="dropdown-title"><span class="title">用户手册</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/zh/manual/cloud/" class="nav-link">数蛙工业数据云平台</a></li><li class="dropdown-item"><!----> <a href="/zh/manual/edge/" class="nav-link">数蛙工业边缘网关</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="产品说明" class="dropdown-title"><span class="title">产品说明</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/zh/product/dgiot/" class="nav-link">一站式物联网平台</a></li><li class="dropdown-item"><!----> <a href="/zh/product/dgtest/" class="nav-link">一站式云压测平台</a></li><li class="dropdown-item"><!----> <a href="/zh/product/dgii/" class="nav-link">工业互联网平台</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="开发指南" class="dropdown-title"><span class="title">开发指南</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/zh/backend/" class="nav-link router-link-active">服务架构</a></li><li class="dropdown-item"><!----> <a href="/zh/frontend/" class="nav-link">交互技术</a></li><li class="dropdown-item"><!----> <a href="/zh/dataanalysis/" class="nav-link">数据分析</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="实战教程" class="dropdown-title"><span class="title">实战教程</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/zh/blog/" class="nav-link">实战教程</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Select language" class="dropdown-title"><span class="title">选择语言</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/zh/backend/emqx/advanced/retransmission.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">简体中文</a></li><li class="dropdown-item"><!----> <a href="/en/" class="nav-link">English</a></li></ul></div></div> <a href="https://github.com/dgiot" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav> <div style="padding-left:1.5rem;"><div></div></div> <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>产品概览</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>EMQX</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/zh/backend/emqx/" aria-current="page" class="sidebar-link">EMQX 简介</a></li><li><a href="/zh/backend/emqx/introduction/checklist.html" class="sidebar-link">EMQX 功能列表</a></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>开始使用</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading open"><span>用户指南</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/zh/backend/emqx/advanced/auth.html" class="sidebar-link">认证鉴权</a></li><li><a href="/zh/backend/emqx/advanced/acl.html" class="sidebar-link">发布订阅 ACL</a></li><li><a href="/zh/backend/emqx/rule/rule-engine.html" class="sidebar-link">规则引擎</a></li><li><a href="/zh/backend/emqx/backend/backend.html" class="sidebar-link">数据存储</a></li><li><a href="/zh/backend/emqx/bridge/bridge.html" class="sidebar-link">消息桥接</a></li><li><a href="/zh/backend/emqx/advanced/shared-subscriptions.html" class="sidebar-link">共享订阅</a></li><li><a href="/zh/backend/emqx/advanced/blacklist.html" class="sidebar-link">$SYS 系统主题</a></li><li><a href="/zh/backend/emqx/getting-started/dashboard-ee.html" class="sidebar-link">黑名单</a></li><li><a href="/zh/backend/emqx/advanced/webhook.html" class="sidebar-link">WebHook</a></li><li><a href="/zh/backend/emqx/advanced/cluster.html" class="sidebar-link">分布集群</a></li><li><a href="/zh/backend/emqx/advanced/hooks.html" class="sidebar-link">钩子</a></li><li><a href="/zh/backend/emqx/advanced/metrics-and-stats.html" class="sidebar-link">指标监控</a></li><li><a href="/zh/backend/emqx/advanced/rate-limit.html" class="sidebar-link">速率限制</a></li><li><a href="/zh/backend/emqx/advanced/inflight-window-and-message-queue.html" class="sidebar-link">飞行窗口与消息队列</a></li><li><a href="/zh/backend/emqx/advanced/retransmission.html" aria-current="page" class="active sidebar-link">消息重传</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/zh/backend/emqx/advanced/retransmission.html#基础配置" class="sidebar-link">基础配置</a></li><li class="sidebar-sub-header"><a href="/zh/backend/emqx/advanced/retransmission.html#协议规范与设计" class="sidebar-link">协议规范与设计</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/zh/backend/emqx/advanced/retransmission.html#重传的对象" class="sidebar-link">重传的对象</a></li><li class="sidebar-sub-header"><a href="/zh/backend/emqx/advanced/retransmission.html#飞行窗口与最大接收值" class="sidebar-link">飞行窗口与最大接收值</a></li><li class="sidebar-sub-header"><a href="/zh/backend/emqx/advanced/retransmission.html#消息顺序" class="sidebar-link">消息顺序</a></li><li class="sidebar-sub-header"><a href="/zh/backend/emqx/advanced/retransmission.html#相关配置" class="sidebar-link">相关配置</a></li></ul></li></ul></li><li><a href="/zh/backend/emqx/advanced/alarms.html" class="sidebar-link">告警</a></li><li><a href="/zh/backend/emqx/advanced/data-import-and-export.html" class="sidebar-link">数据导入导出</a></li></ul></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>模块管理</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>规则引擎</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>插件管理</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>运维操作</span> <span class="arrow right"></span></p> <!----></section></li><li><a href="/zh/backend/emqx/advanced/http-api.html" class="sidebar-link">HTTP API</a></li><li><a href="/zh/backend/emqx/configuration/configuration.html" class="sidebar-link">参数配置</a></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>命令行接口</span> <span class="arrow right"></span></p> <!----></section></li><li><a href="/zh/backend/emqx/advanced/relup.html" class="sidebar-link">版本热升级</a></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>FAQ 常见问题解答</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>SDK &amp; Tools</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>协议介绍</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>版本发布</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>相关资料</span> <span class="arrow right"></span></p> <!----></section></li></ul></section></li></ul> </aside> <!----> <!----> <main class="page"><div class="theme-default-content" style="margin-top:3.6rem;padding-top:0;padding-bottom:0;"></div> <div class="theme-default-content"><div class="content__default"><h1 id="消息重传"><a href="#消息重传" class="header-anchor">#</a> 消息重传</h1> <p>消息重传 (Message Retransmission) 是属于 MQTT 协议标准规范的一部分。</p> <p>协议中规定了作为通信的双方 <strong>服务端</strong> 和 <strong>客户端</strong> 对于自己发送到对端的 PUBLISH 消息都应满足其 <strong>服务质量 (Quality of Service levels)</strong> 的要求。如：</p> <ul><li><p>QoS 1：表示 <strong>消息至少送达一次 (At least once delivery)</strong>；即发送端会一直重发该消息，除非收到了对端对该消息的确认。意思是在 MQTT 协议的上层（即业务的应用层）相同的 QoS 1 消息可能会收到多次。</p></li> <li><p>QoS 2：表示 <strong>消息只送达一次 (Exactly once delivery)</strong>；即该消息在上层仅会接收到一次。</p></li></ul> <p>虽然，QoS 1 和 QoS 2 的 PUBLISH 报文在 MQTT 协议栈这一层都会发生重传，但请你谨记的是：</p> <ul><li>QoS 1 消息发生重传后，在 MQTT 协议栈上层，也会收到这些重发的 PUBLISH 消息。</li> <li>QoS 2 消息无论如何重传，最终在 MQTT 协议栈上层，都只会收到一条 PUBLISH 消息</li></ul> <h2 id="基础配置"><a href="#基础配置" class="header-anchor">#</a> 基础配置</h2> <p>有两种场景会导致消息重发：</p> <ol><li>PUBLISH 报文发送给对端后，规定时间内未收到应答。则重发这个报文。</li> <li>在保持会话的情况下，客户端重连后；EMQ X 会自动重发  <em>未应答的消息</em>，以确保 QoS 流程的正确。</li></ol> <p>在 <code>etc/emqx.conf</code> 中可配置：</p> <table><thead><tr><th>配置项</th> <th>类型</th> <th>可取值</th> <th>默认值</th> <th>说明</th></tr></thead> <tbody><tr><td>retry_interval</td> <td>duration</td> <td>-</td> <td>30s</td> <td>等待一个超时间隔，如果没收到应答则重传消息</td></tr></tbody></table> <p>一般来说，你只需要关心以上内容就足够了。</p> <p>如需了解更多 EMQ X 在处理 MQTT 协议的重传的细节见以下内容。</p> <h2 id="协议规范与设计"><a href="#协议规范与设计" class="header-anchor">#</a> 协议规范与设计</h2> <h3 id="重传的对象"><a href="#重传的对象" class="header-anchor">#</a> 重传的对象</h3> <p>首先，在了解 EMQ X 对于重传机制的设计前，我们需要先确保你已经了解协议中 QoS 1 和 QoS 2 的传输过程，否则请参见 <a href="http://docs.oasis-open.org/mqtt/mqtt/v3.1.1/os/mqtt-v3.1.1-os.html#_Toc398718101" target="_blank" rel="noopener noreferrer">MQTTv3.1.1 - QoS 1: At least once delivery<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 和 <a href="http://docs.oasis-open.org/mqtt/mqtt/v3.1.1/os/mqtt-v3.1.1-os.html#_Toc398718102" target="_blank" rel="noopener noreferrer">MQTTv3.1.1 - QoS 2: Exactly once delivery<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。</p> <p>此处，仅作一个简单的回顾，用来说明不同 QoS 下重传的对象有哪些。</p> <h4 id="qos-1"><a href="#qos-1" class="header-anchor">#</a> QoS 1</h4> <p>QoS 1 要求消息至少送达一次；所以消息在 MQTT 协议层中，可能会不断的重传，直到发送端收到了该消息的确认报文。</p> <p>其流程示意图如下：</p> <div class="language- extra-class"><pre class="language-text"><code>               PUBLISH
#1 Sender  ---------------&gt;  Receiver       (*)
               PUBACK
#2 Sender  &lt;---------------  Receiver
</code></pre></div><ul><li>涉及到 2 个报文；共 2 次发送动作，发送端和接收端各 1 次；这 2 个报文都持有相同的 PacketId。</li> <li>行尾标记为 * 号的，表示发送方在等待确认报文超时后，可能会主动发起重传。</li></ul> <p>可见 <strong>QoS 1 消息只需要对 PUBLISH 报文进行重发</strong></p> <h4 id="qos-2"><a href="#qos-2" class="header-anchor">#</a> QoS 2</h4> <p>QoS 2 要求消息只送达一次；所以在实现它时，需要更复杂的流程。其流程示意图如下：</p> <div class="language- extra-class"><pre class="language-text"><code>               PUBLISH
#1 Sender  ---------------&gt;  Receiver       (*)
               PUBREC
#2 Sender  &lt;---------------  Receiver
               PUBREL
#3 Sender  ---------------&gt;  Receiver       (*)
               PUBCOM
#4 Sender  &lt;---------------  Receiver
</code></pre></div><ul><li>涉及到 4 个报文；共 4 次发送动作，发送端和接收端各 2 次；这 4 个报文都持有相同的 PacketId。</li> <li>行尾标记为 * 号的，表示发送方在等待确认报文超时后，可能会主动发起重传。</li></ul> <p>可见 <strong>QoS 2 消息需要对 PUBLISH 和 PUBREL 报文进行重发</strong></p> <p>综上：</p> <ul><li><p><strong>重传动作</strong> 都是由于 <strong>发送端</strong> 报文发送后，在 <strong>规定时间</strong> 内未收到其期待的返回而触发的。</p></li> <li><p><strong>重传对象</strong> 仅包含以下三种：</p> <ul><li>QoS 1 的 PUBLISH 报文</li> <li>QoS 2 的 PUBLISH 报文</li> <li>QoS 2 的 PUBREL 报文</li></ul></li></ul> <p>当 EMQ X 作为 PUBLISH 消息的接收端时，它不需要重发操作</p> <h3 id="飞行窗口与最大接收值"><a href="#飞行窗口与最大接收值" class="header-anchor">#</a> 飞行窗口与最大接收值</h3> <p>其概念的定义和解释参见 <a href="/zh/backend/emqx/advanced/inflight-window-and-message-queue.html#">飞行窗口与消息队列</a></p> <p>引入这两个概念的作用是为了理解：</p> <ol><li>EMQ X 作为发送端时，再次重发的消息，必然是已存储在飞行窗口中的消息</li> <li>EMQ X 作为接收端时，发送端重发的消息时：
<ul><li>如 QoS 1，EMQ X 则直接回复 PUBACK 进行应答；</li> <li>如 QoS 2，EMQ X 则会释放，存储在 <em>最大接收消息</em> 队列中的 PUBLISH 或者 PUBREL 报文。</li></ul></li></ol> <h3 id="消息顺序"><a href="#消息顺序" class="header-anchor">#</a> 消息顺序</h3> <p>当然，以上的概念仅需要了解即可，你最需要关心的是，<strong>消息在被重复发送后，消息顺序出现的变化，尤其是 QoS 1 类的消息</strong>。例如：</p> <p>假设，当前飞行窗口设置为 2 时，EMQ X 计划向客户端的某主题投递 4 条 QoS 1 的消息。并假设客户端程序、或网络在中间出现过问题，那么整个发送流程会变成：</p> <div class="language- extra-class"><pre class="language-text"><code>#1  [4,3,2,1 || ]   -----&gt;   []
#2  [4,3 || 2, 1]   -----&gt;   [1, 2]
#3  [4 || 3, 2]     -----&gt;   [1, 2, 3]
#4  [4 || 3, 2]     -----&gt;   [1, 2, 3, 2, 3]
#5  [ || 4]         -----&gt;   [1, 2, 3, 2, 3, 4]
#6  [ || ]          -----&gt;   [1, 2, 3, 2, 3, 4]
</code></pre></div><p>流程共 6 个步骤；左边表示 EMQ X 的 消息队列 和 飞行窗口，以 <code>||</code> 分割；右侧表示客户端收到的消息顺序，其中每步表示：</p> <ol><li>Broker 将 4 条消息放入消息队列中。</li> <li>Broker 依次发送 <code>1</code> <code>2</code>，并将其放入 <strong>飞行窗口</strong> 中；客户端仅应答消息 <code>1</code>；且此时由于客户端发送流出现了问题，无法发送后续应答报文。</li> <li>Broker 收到消息 <code>1</code> 的应答；从飞行窗口移除消息 <code>1</code>；并将 <code>3</code> 发送出去；继续等待 <code>2</code> <code>3</code> 的应答；</li> <li>Broker 等待应答超时，重发了报文 <code>2</code> <code>3</code>；客户端收到重发的报文 <code>2</code> <code>3</code> 并正常应答。</li> <li>Broker 从飞行窗口移除了消息 <code>2</code> <code>3</code>，并发送报文 <code>4</code>；客户端收到了报文 4 并回复应答。</li> <li>至此，所有报文处理完成。客户端收到的报文顺序为 <code>[1, 2, 3, 2, 3, 4]</code>，并也依次上报给 MQTT 协议栈的上层。</li></ol> <p>虽然，存在重复的报文消息。但这是完全符合协议的规范的，每个报文第一次出现的位置都是有序的，并且重复收到的报文 <code>2</code> <code>3</code> 的报文中，会携带一个标识位，表明其为重发报文。</p> <p>MQTT 协议和 EMQ X 将这个主题认为是 <code>有序的主题 (Ordered Topic)</code> 参见: <a href="http://docs.oasis-open.org/mqtt/mqtt/v3.1.1/os/mqtt-v3.1.1-os.html#_Toc398718105" target="_blank" rel="noopener noreferrer">MQTTv3.1.1 - Message ordering<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。</p> <p>它确保 <strong>相同的主题和 QoS 下，消息是按顺序投递和应答的</strong>。</p> <p>此外，如果用户期望所有主题下的 QoS 1 与 QoS 2 消息都严格有序，那么需要设置飞行窗口的最大长度为 1，但代价是会降低该客户端的吞吐。</p> <h3 id="相关配置"><a href="#相关配置" class="header-anchor">#</a> 相关配置</h3> <p>此节列举了上述机制中，用到的所有配置。它们都包含在 <code>etc/emqx.conf</code> 中：</p> <table><thead><tr><th>配置项</th> <th>类型</th> <th>可取值</th> <th>默认值</th> <th>说明</th></tr></thead> <tbody><tr><td>mqueue_store_qos0</td> <td>bool</td> <td><code>true</code>, <code>false</code></td> <td>true</td> <td>是否将 QoS 0 消息存入消息队列中</td></tr> <tr><td>max_mqueue_len</td> <td>integer</td> <td>&gt;= 0</td> <td>1000</td> <td>消息队列长度</td></tr> <tr><td>max_inflight</td> <td>integer</td> <td>&gt;= 0</td> <td>0</td> <td>飞行窗口大小；默认 <code>0</code> 即无限制</td></tr> <tr><td>max_awaiting_rel</td> <td>integer</td> <td>&gt;= 0</td> <td>0</td> <td>最大接收；默认 <code>0</code> 即无限制</td></tr> <tr><td>await_rel_timeout</td> <td>durtaion</td> <td>&gt;  0</td> <td>300s</td> <td><code>最大接收</code> 中消息等待释放的最大超时时间；超过则直接丢弃</td></tr></tbody></table></div> <!----></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">4/7/2021, 9:58:48 AM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/zh/backend/emqx/advanced/inflight-window-and-message-queue.html" class="prev">飞行窗口与消息队列</a></span> <span class="next"><a href="/zh/backend/emqx/advanced/alarms.html">告警</a>
      →
    </span></p></div> </main></div><div class="global-ui"><div class="add-this"></div><div tabindex="-1" role="dialog" aria-hidden="true" class="pswp"><div class="pswp__bg"></div> <div class="pswp__scroll-wrap"><div class="pswp__container"><div class="pswp__item"></div> <div class="pswp__item"></div> <div class="pswp__item"></div></div> <div class="pswp__ui pswp__ui--hidden"><div class="pswp__top-bar"><div class="pswp__counter"></div> <button title="Close (Esc)" class="pswp__button pswp__button--close"></button> <button title="Share" class="pswp__button pswp__button--share"></button> <button title="Toggle fullscreen" class="pswp__button pswp__button--fs"></button> <button title="Zoom in/out" class="pswp__button pswp__button--zoom"></button> <div class="pswp__preloader"><div class="pswp__preloader__icn"><div class="pswp__preloader__cut"><div class="pswp__preloader__donut"></div></div></div></div></div> <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class="pswp__share-tooltip"></div></div> <button title="Previous (arrow left)" class="pswp__button pswp__button--arrow--left"></button> <button title="Next (arrow right)" class="pswp__button pswp__button--arrow--right"></button> <div class="pswp__caption"><div class="pswp__caption__center"></div></div></div></div></div></div></div>
    <script src="/assets/js/app.dd8e618a.js" defer></script><script src="/assets/js/6.a55563ee.js" defer></script><script src="/assets/js/5.451ad62b.js" defer></script><script src="/assets/js/74.c3b58433.js" defer></script>
  </body>
</html>
