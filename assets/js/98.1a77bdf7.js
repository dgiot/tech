(window.webpackJsonp=window.webpackJsonp||[]).push([[98],{467:function(s,a,t){"use strict";t.r(a);var e=t(7),n=Object(e.a)({},(function(){var s=this,a=s.$createElement,t=s._self._c||a;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h2",{attrs:{id:"mqtt-桥接"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#mqtt-桥接"}},[s._v("#")]),s._v(" MQTT 桥接")]),s._v(" "),t("p",[s._v("EMQ X 桥接转发 MQTT 消息到 MQTT Broker，支持桥接至常见 MQTT 云服务:")]),s._v(" "),t("p",[t("img",{attrs:{src:"http://dgiot-1253666439.cos.ap-shanghai-fsi.myqcloud.com/shuwa_tech/zh/backend/emqx/bridge/assets/bridge_mqtt.png",alt:"bridge_mqtt.png"}})]),s._v(" "),t("p",[s._v("mqtt bridge 桥接插件配置文件: etc/plugins/emqx_bridge_mqtt.conf。")]),s._v(" "),t("h3",{attrs:{id:"配置-mqtt-桥接的-broker-地址"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#配置-mqtt-桥接的-broker-地址"}},[s._v("#")]),s._v(" 配置 MQTT 桥接的 Broker 地址")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 桥接地址： 使用节点名则用于 rpc 桥接，使用 host:port 用于 mqtt 连接")]),s._v("\nbridge.mqtt.aws.address "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:1883\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 桥接的协议版本")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 枚举值: mqttv3 | mqttv4 | mqttv5")]),s._v("\nbridge.mqtt.aws.proto_ver "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" mqttv4\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## mqtt 连接是否启用桥接模式")]),s._v("\nbridge.mqtt.aws.bridge_mode "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## mqtt 客户端的 client_id")]),s._v("\nbridge.mqtt.aws.client_id "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" bridge_aws\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## mqtt 客户端的 clean_start 字段")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 注: 有些 MQTT Broker 需要将 clean_start 值设成 `true`")]),s._v("\nbridge.mqtt.aws.clean_start "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## mqtt 客户端的 username 字段")]),s._v("\nbridge.mqtt.aws.username "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" user\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## mqtt 客户端的 password 字段")]),s._v("\nbridge.mqtt.aws.password "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("passwd")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## mqtt 客户端是否使用 ssl 来连接远程服务器")]),s._v("\nbridge.mqtt.aws.ssl "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" off\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 客户端 SSL 连接的 CA 证书 (PEM格式)")]),s._v("\nbridge.mqtt.aws.cacertfile "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" etc/certs/cacert.pem\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 客户端 SSL 连接的 SSL 证书")]),s._v("\nbridge.mqtt.aws.certfile "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" etc/certs/client-cert.pem\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 客户端 SSL 连接的密钥文件")]),s._v("\nbridge.mqtt.aws.keyfile "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" etc/certs/client-key.pem\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## SSL 加密算法")]),s._v("\nbridge.mqtt.aws.ciphers "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" ECDHE-ECDSA-AES256-GCM-SHA384,ECDHE-RSA-AES256-GCM-SHA384\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## TLS PSK 的加密算法")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 注意 'listener.ssl.external.ciphers' 和 'listener.ssl.external.psk_ciphers' 不能同时配置")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("##")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## See 'https://tools.ietf.org/html/rfc4279#section-2'.")]),s._v("\nbridge.mqtt.aws.psk_ciphers "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" PSK-AES128-CBC-SHA,PSK-AES256-CBC-SHA,PSK-3DES-EDE-CBC-SHA,PSK-RC4-SHA\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 客户端的心跳间隔")]),s._v("\nbridge.mqtt.aws.keepalive "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" 60s\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 支持的 TLS 版本")]),s._v("\nbridge.mqtt.aws.tls_versions "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" tlsv1.2,tlsv1.1,tlsv1\n")])])]),t("h3",{attrs:{id:"配置-mqtt-桥接转发和订阅主题"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#配置-mqtt-桥接转发和订阅主题"}},[s._v("#")]),s._v(" 配置 MQTT 桥接转发和订阅主题")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 桥接的 mountpoint(挂载点)")]),s._v("\nbridge.mqtt.aws.mountpoint "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" bridge/aws/"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${node}")]),s._v("/\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 转发消息的主题")]),s._v("\nbridge.mqtt.aws.forwards "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" topic1/"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#,topic2/#")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 用于桥接的订阅主题")]),s._v("\nbridge.mqtt.aws.subscription.1.topic "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" cmd/topic1\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 用于桥接的订阅 qos")]),s._v("\nbridge.mqtt.aws.subscription.1.qos "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 用于桥接的订阅主题")]),s._v("\nbridge.mqtt.aws.subscription.2.topic "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" cmd/topic2\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 用于桥接的订阅 qos")]),s._v("\nbridge.mqtt.aws.subscription.2.qos "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n")])])]),t("h3",{attrs:{id:"mqtt-桥接转发和订阅主题说明"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#mqtt-桥接转发和订阅主题说明"}},[s._v("#")]),s._v(" MQTT 桥接转发和订阅主题说明")]),s._v(" "),t("p",[s._v("挂载点 Mountpoint: mountpoint 用于在转发消息时加上主题前缀，该配置选项须配合 forwards 使用，转发主题为\nsensor1/hello 的消息, 到达远程节点时主题为 bridge/aws/emqx1@192.168.1.1/sensor1/hello。")]),s._v(" "),t("p",[s._v("转发主题 Forwards: 转发到本地 EMQX 指定 forwards 主题上的消息都会被转发到远程 MQTT Broker 上。")]),s._v(" "),t("p",[s._v("订阅主题 Subscription: 本地 EMQX 通过订阅远程 MQTT Broker 的主题来将远程 MQTT Broker\n上的消息同步到本地。")]),s._v(" "),t("h3",{attrs:{id:"启用-bridge-mqtt-桥接插件"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#启用-bridge-mqtt-桥接插件"}},[s._v("#")]),s._v(" 启用 bridge_mqtt 桥接插件")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("./bin/emqx_ctl plugins load emqx_bridge_mqtt\n")])])]),t("h3",{attrs:{id:"桥接-cli-命令"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#桥接-cli-命令"}},[s._v("#")]),s._v(" 桥接 CLI 命令")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("$ "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" emqx1/ "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" ./bin/emqx_ctl bridges\nbridges list                                    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# List bridges")]),s._v("\nbridges start "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("Name"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("                            "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Start a bridge")]),s._v("\nbridges stop "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("Name"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("                             "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Stop a bridge")]),s._v("\nbridges forwards "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("Name"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("                         "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Show a bridge forward topic")]),s._v("\nbridges add-forward "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("Name"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("Topic"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("              "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Add bridge forward topic")]),s._v("\nbridges del-forward "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("Name"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("Topic"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("              "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Delete bridge forward topic")]),s._v("\nbridges subscriptions "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("Name"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("                    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Show a bridge subscriptions topic")]),s._v("\nbridges add-subscription "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("Name"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("Topic"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("Qos"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("   "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Add bridge subscriptions topic")]),s._v("\n")])])]),t("h3",{attrs:{id:"列出全部-bridge-状态"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#列出全部-bridge-状态"}},[s._v("#")]),s._v(" 列出全部 bridge 状态")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("$ ./bin/emqx_ctl bridges list\nname: emqx     status: Stopped\n")])])]),t("h3",{attrs:{id:"启动指定-bridge"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#启动指定-bridge"}},[s._v("#")]),s._v(" 启动指定 bridge")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("$ ./bin/emqx_ctl bridges start emqx\nStart bridge successfully.\n")])])]),t("h3",{attrs:{id:"停止指定-bridge"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#停止指定-bridge"}},[s._v("#")]),s._v(" 停止指定 bridge")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("$ ./bin/emqx_ctl bridges stop emqx\nStop bridge successfully.\n")])])]),t("h3",{attrs:{id:"列出指定-bridge-的转发主题"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#列出指定-bridge-的转发主题"}},[s._v("#")]),s._v(" 列出指定 bridge 的转发主题")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("$ ./bin/emqx_ctl bridges forwards emqx\ntopic:   topic1/"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#")]),s._v("\ntopic:   topic2/"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#")]),s._v("\n")])])]),t("h3",{attrs:{id:"添加指定-bridge-的转发主题"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#添加指定-bridge-的转发主题"}},[s._v("#")]),s._v(" 添加指定 bridge 的转发主题")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("$ ./bin/emqx_ctl bridges add-forwards emqx topic3/"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#")]),s._v("\nAdd-forward topic successfully.\n")])])]),t("h3",{attrs:{id:"删除指定-bridge-的转发主题"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#删除指定-bridge-的转发主题"}},[s._v("#")]),s._v(" 删除指定 bridge 的转发主题")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("$ ./bin/emqx_ctl bridges del-forwards emqx topic3/"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#")]),s._v("\nDel-forward topic successfully.\n")])])]),t("h3",{attrs:{id:"列出指定-bridge-的订阅"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#列出指定-bridge-的订阅"}},[s._v("#")]),s._v(" 列出指定 bridge 的订阅")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("$ ./bin/emqx_ctl bridges subscriptions emqx\ntopic: cmd/topic1, qos: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\ntopic: cmd/topic2, qos: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n")])])]),t("h3",{attrs:{id:"添加指定-bridge-的订阅主题"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#添加指定-bridge-的订阅主题"}},[s._v("#")]),s._v(" 添加指定 bridge 的订阅主题")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("$ ./bin/emqx_ctl bridges add-subscription emqx cmd/topic3 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\nAdd-subscription topic successfully.\n")])])]),t("h3",{attrs:{id:"删除指定-bridge-的订阅主题"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#删除指定-bridge-的订阅主题"}},[s._v("#")]),s._v(" 删除指定 bridge 的订阅主题")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("$ ./bin/emqx_ctl bridges del-subscription emqx cmd/topic3\nDel-subscription topic successfully.\n")])])]),t("h2",{attrs:{id:"rpc-桥接"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#rpc-桥接"}},[s._v("#")]),s._v(" RPC 桥接")]),s._v(" "),t("p",[s._v("EMQ X 桥接转发 MQTT 消息到远程 EMQ X:")]),s._v(" "),t("p",[t("img",{attrs:{src:"http://dgiot-1253666439.cos.ap-shanghai-fsi.myqcloud.com/shuwa_tech/zh/backend/emqx/bridge/assets/bridge_rpc.png",alt:"bridge_rpc.png"}})]),s._v(" "),t("p",[s._v("rpc bridge 桥接插件配置文件: etc/plugins/emqx_bridge_mqtt.conf")]),s._v(" "),t("h3",{attrs:{id:"配置-rpc-桥接的-broker-地址"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#配置-rpc-桥接的-broker-地址"}},[s._v("#")]),s._v(" 配置 RPC 桥接的 Broker 地址")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("bridge.mqtt.emqx.address "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" emqx2@192.168.1.2\n")])])]),t("h3",{attrs:{id:"配置-mqtt-桥接转发和订阅主题-2"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#配置-mqtt-桥接转发和订阅主题-2"}},[s._v("#")]),s._v(" 配置 MQTT 桥接转发和订阅主题")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 桥接的 mountpoint(挂载点)")]),s._v("\nbridge.mqtt.emqx.mountpoint "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" bridge/emqx1/"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${node}")]),s._v("/\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 转发消息的主题")]),s._v("\nbridge.mqtt.emqx.forwards "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" topic1/"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#,topic2/#")]),s._v("\n")])])]),t("h3",{attrs:{id:"mqtt-桥接转发和订阅主题说明-2"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#mqtt-桥接转发和订阅主题说明-2"}},[s._v("#")]),s._v(" MQTT 桥接转发和订阅主题说明")]),s._v(" "),t("p",[s._v("挂载点 Mountpoint: mountpoint 用于在转发消息时加上主题前缀，该配置选项须配合 forwards 使用，转发主题为\nsensor1/hello 的消息, 到达远程节点时主题为 bridge/aws/emqx1@192.168.1.1/sensor1/hello。")]),s._v(" "),t("p",[s._v("转发主题 Forwards: 转发到本地 EMQX 指定 forwards 主题上的消息都会被转发到远程 MQTT Broker 上。")]),s._v(" "),t("h3",{attrs:{id:"桥接-cli-命令-2"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#桥接-cli-命令-2"}},[s._v("#")]),s._v(" 桥接 CLI 命令")]),s._v(" "),t("p",[s._v("桥接 CLI 的使用方式与 mqtt bridge 相同。")]),s._v(" "),t("h2",{attrs:{id:"kafka-桥接"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#kafka-桥接"}},[s._v("#")]),s._v(" Kafka 桥接")]),s._v(" "),t("p",[s._v("EMQ X 桥接转发 MQTT 消息到 Kafka 集群，Apache Kafka是一个快速、高可扩展、高吞吐的分布式日志系统，配合kafka Stream，在流式数据处理中非常常用。")]),s._v(" "),t("p",[t("img",{attrs:{src:"http://dgiot-1253666439.cos.ap-shanghai-fsi.myqcloud.com/shuwa_tech/zh/backend/emqx/bridge/assets/bridge_kafka.png",alt:"bridge_kafka.png"}})]),s._v(" "),t("p",[s._v("Kafka 桥接插件配置文件: etc/plugins/emqx_bridge_kafka.conf。")]),s._v(" "),t("h3",{attrs:{id:"配置-kafka-集群地址"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#配置-kafka-集群地址"}},[s._v("#")]),s._v(" 配置 Kafka 集群地址")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## Kafka 服务器地址")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## bridge.kafka.servers = 127.0.0.1:9092,127.0.0.2:9092,127.0.0.3:9092")]),s._v("\nbridge.kafka.servers "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:9092\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## Kafka 分区策略。可选值: per_partition | per_broker")]),s._v("\nbridge.kafka.connection_strategy "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" per_partition\n\nbridge.kafka.min_metadata_refresh_interval "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" 5S\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## Produce 写类型。可选值: sync | async")]),s._v("\nbridge.kafka.produce "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sync")]),s._v("\n\nbridge.kafka.produce.sync_timeout "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" 3S\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 指定 replayq 在磁盘上存储消息的基本目录。")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 如果该配置项缺失活着设置为 undefined, replayq 将以使用内存的")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 的方式工作。也就是说，消息不在磁盘上排队 -- 在这种情况下，send")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 和 send_async API 的调用者负责处理在应用程序、网络或 kafka")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 干扰时可能丢失的消息。")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## bridge.kafka.replayq_dir = /tmp/emqx_bridge_kafka/")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## default=10MB, replayq 分段大小。")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## bridge.kafka.producer.replayq_seg_bytes = 10MB")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## producer required_acks. 可选值: all_isr | leader_only | none.")]),s._v("\nbridge.kafka.producer.required_acks "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" none\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## default=10000. leader 在回复 producer 前等待副本的超时时间。")]),s._v("\nbridge.kafka.producer.ack_timeout "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" 10S\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 收集到一次 produce 请求中的最大字节数")]),s._v("\nbridge.kafka.producer.max_batch_bytes "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" 1024KB\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 收集到一次 produce 请求中的最少字节数")]),s._v("\nbridge.kafka.producer.min_batch_bytes "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 在没有接收到上次请求的 ack 的情况下，可以提前发送的 batch 数。")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 如果消息必须严格按照顺序传递，则必须为0。")]),s._v("\nbridge.kafka.producer.max_send_ahead "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 默认为无压缩")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## bridge.kafka.producer.compression = no_compression")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 默认值为 base64, 可选值: base64 | plain")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## bridge.kafka.encode_payload_type = base64")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## bridge.kafka.sock.buffer = 32KB")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## bridge.kafka.sock.recbuf = 32KB")]),s._v("\nbridge.kafka.sock.sndbuf "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" 1MB\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## bridge.kafka.sock.read_packets = 20")]),s._v("\n")])])]),t("h3",{attrs:{id:"配置-kafka-桥接规则"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#配置-kafka-桥接规则"}},[s._v("#")]),s._v(" 配置 Kafka 桥接规则")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## Bridge Kafka Hooks")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## ${topic}: the kafka topics to which the messages will be published.")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## ${filter}: the mqtt topic (may contain wildcard) on which the action will be performed.")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## Client Connected Record Hook")]),s._v("\nbridge.kafka.hook.client.connected.1     "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"topic"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"client_connected"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## Client Disconnected Record Hook")]),s._v("\nbridge.kafka.hook.client.disconnected.1  "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"topic"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"client_disconnected"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## Session Subscribed Record Hook")]),s._v("\nbridge.kafka.hook.session.subscribed.1   "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"filter"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"#"')]),s._v(",  "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"topic"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"session_subscribed"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## Session Unsubscribed Record Hook")]),s._v("\nbridge.kafka.hook.session.unsubscribed.1 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"filter"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"#"')]),s._v(",  "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"topic"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"session_unsubscribed"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## Message Publish Record Hook")]),s._v("\nbridge.kafka.hook.message.publish.1      "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"filter"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"#"')]),s._v(",  "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"topic"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"message_publish"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## Message Delivered Record Hook")]),s._v("\nbridge.kafka.hook.message.delivered.1    "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"filter"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"#"')]),s._v(",  "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"topic"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"message_delivered"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## Message Acked Record Hook")]),s._v("\nbridge.kafka.hook.message.acked.1        "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"filter"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"#"')]),s._v(",  "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"topic"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"message_acked"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## More Configures")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## partitioner strategy:")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## Option:  random | roundrobin | first_key_dispatch")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v('## Example: bridge.kafka.hook.message.publish.1 = {"filter":"#", "topic":"message_publish", "strategy":"random"}')]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## key:")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## Option: ${clientid} | ${username}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v('## Example: bridge.kafka.hook.message.publish.1 = {"filter":"#", "topic":"message_publish", "key":"${clientid}"}')]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## format:")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## Option: json | json")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v('## Example: bridge.kafka.hook.message.publish.1 = {"filter":"#", "topic":"message_publish", "format":"json"}')]),s._v("\n")])])]),t("h3",{attrs:{id:"kafka-桥接规则说明"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#kafka-桥接规则说明"}},[s._v("#")]),s._v(" Kafka 桥接规则说明")]),s._v(" "),t("table",[t("thead",[t("tr",[t("th",[s._v("事件")]),s._v(" "),t("th",[s._v("说明")])])]),s._v(" "),t("tbody",[t("tr",[t("td",[s._v("bridge.kafka.hook.client.connected.1")]),s._v(" "),t("td",[s._v("客户端登录")])]),s._v(" "),t("tr",[t("td",[s._v("bridge.kafka.hook.client.disconnected.1")]),s._v(" "),t("td",[s._v("客户端退出")])]),s._v(" "),t("tr",[t("td",[s._v("bridge.kafka.hook.session.subscribed.1")]),s._v(" "),t("td",[s._v("订阅主题")])]),s._v(" "),t("tr",[t("td",[s._v("bridge.kafka.hook.session.unsubscribed.1")]),s._v(" "),t("td",[s._v("取消订阅主题")])]),s._v(" "),t("tr",[t("td",[s._v("bridge.kafka.hook.message.publish.1")]),s._v(" "),t("td",[s._v("发布消息")])]),s._v(" "),t("tr",[t("td",[s._v("bridge.kafka.hook.message.delivered.1")]),s._v(" "),t("td",[s._v("delivered 消息")])]),s._v(" "),t("tr",[t("td",[s._v("bridge.kafka.hook.message.acked.1")]),s._v(" "),t("td",[s._v("ACK 消息")])])])]),s._v(" "),t("h3",{attrs:{id:"客户端上下线事件转发-kafka"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#客户端上下线事件转发-kafka"}},[s._v("#")]),s._v(" 客户端上下线事件转发 Kafka")]),s._v(" "),t("p",[s._v("设备上线 EMQ X 转发上线事件消息到 Kafka:")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("topic "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"client_connected"')]),s._v(",\nvalue "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"client_id"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${clientid}")]),s._v(",\n  "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"username"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${username}")]),s._v(",\n  "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"node"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${node}")]),s._v(",\n  "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"ts"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${ts}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])])]),t("p",[s._v("设备下线 EMQ X 转发下线事件消息到 Kafka:")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("topic "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"client_disconnected"')]),s._v(",\nvalue "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"client_id"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${clientid}")]),s._v(",\n  "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"username"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${username}")]),s._v(",\n  "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"reason"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${reason}")]),s._v(",\n  "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"node"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${node}")]),s._v(",\n  "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"ts"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${ts}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])])]),t("h3",{attrs:{id:"客户端订阅主题事件转发-kafka"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#客户端订阅主题事件转发-kafka"}},[s._v("#")]),s._v(" 客户端订阅主题事件转发 Kafka")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("topic "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" session_subscribed\n\nvalue "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"client_id"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${clientid}")]),s._v(",\n  "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"topic"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${topic}")]),s._v(",\n  "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"qos"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${qos}")]),s._v(",\n  "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"node"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${node}")]),s._v(",\n  "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"ts"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${timestamp}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])])]),t("h3",{attrs:{id:"客户端取消订阅主题事件转发-kafka"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#客户端取消订阅主题事件转发-kafka"}},[s._v("#")]),s._v(" 客户端取消订阅主题事件转发 Kafka")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("topic "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" session_unsubscribed\n\nvalue "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"client_id"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${clientid}")]),s._v(",\n  "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"topic"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${topic}")]),s._v(",\n  "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"qos"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${qos}")]),s._v(",\n  "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"node"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${node}")]),s._v(",\n  "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"ts"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${timestamp}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])])]),t("h3",{attrs:{id:"mqtt-消息转发到-kafka"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#mqtt-消息转发到-kafka"}},[s._v("#")]),s._v(" MQTT 消息转发到 Kafka")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("topic "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" message_publish\n\nvalue "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"client_id"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${clientid}")]),s._v(",\n  "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"username"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${username}")]),s._v(",\n  "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"topic"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${topic}")]),s._v(",\n  "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"payload"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${payload}")]),s._v(",\n  "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"qos"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${qos}")]),s._v(",\n  "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"node"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${node}")]),s._v(",\n  "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"ts"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${timestamp}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])])]),t("h3",{attrs:{id:"mqtt-消息派发-deliver-事件转发-kafka"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#mqtt-消息派发-deliver-事件转发-kafka"}},[s._v("#")]),s._v(" MQTT 消息派发 (Deliver) 事件转发 Kafka")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("topic "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" message_delivered\n\nvalue "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"client_id"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${clientid}")]),s._v(",\n  "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"username"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${username}")]),s._v(",\n  "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"from"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${fromClientId}")]),s._v(",\n  "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"topic"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${topic}")]),s._v(",\n  "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"payload"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${payload}")]),s._v(",\n  "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"qos"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${qos}")]),s._v(",\n  "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"node"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${node}")]),s._v(",\n  "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"ts"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${timestamp}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])])]),t("h3",{attrs:{id:"mqtt-消息确认-ack-事件转发-kafka"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#mqtt-消息确认-ack-事件转发-kafka"}},[s._v("#")]),s._v(" MQTT 消息确认 (Ack) 事件转发 Kafka")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("topic "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" message_acked\n\nvalue "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"client_id"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${clientid}")]),s._v(",\n  "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"username"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${username}")]),s._v(",\n  "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"from"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${fromClientId}")]),s._v(",\n  "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"topic"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${topic}")]),s._v(",\n  "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"payload"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${payload}")]),s._v(",\n  "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"qos"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${qos}")]),s._v(",\n  "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"node"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${node}")]),s._v(",\n  "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"ts"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${timestamp}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])])]),t("h3",{attrs:{id:"kafka-消费示例"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#kafka-消费示例"}},[s._v("#")]),s._v(" Kafka 消费示例")]),s._v(" "),t("p",[s._v("Kafka 读取 MQTT 客户端上下线事件消息:")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("kafka-console-consumer.sh --bootstrap-server "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:9092 --topic client_connected --from-beginning\n    \nkafka-console-consumer.sh --bootstrap-server "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:9092 --topic client_disconnected --from-beginning\n")])])]),t("p",[s._v("Kafka 读取 MQTT 主题订阅事件消息:")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("kafka-console-consumer.sh --bootstrap-server "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:9092 --topic session_subscribed --from-beginning\n\nkafka-console-consumer.sh --bootstrap-server "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:9092 --topic session_unsubscribed --from-beginning\n")])])]),t("p",[s._v("Kafka 读取 MQTT 发布消息:")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("kafka-console-consumer.sh --bootstrap-server "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:9092 --topic message_publish --from-beginning\n")])])]),t("p",[s._v("Kafka 读取 MQTT 消息发布 (Deliver)、确认 (Ack)事件:")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("kafka-console-consumer.sh --bootstrap-server "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:9092 --topic message_delivered --from-beginning\n\nkafka-console-consumer.sh --bootstrap-server "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:9092 --topic message_acked --from-beginning\n")])])]),t("div",{staticClass:"custom-block tip"},[t("p",{staticClass:"custom-block-title"},[s._v("提示")]),s._v(" "),t("p",[s._v("默认 payload 被 base64 编码，可通过修改配置 bridge.kafka.encode_payload_type 指定\npayload 数据格式。")])]),s._v(" "),t("h3",{attrs:{id:"启用-kafka-桥接插件"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#启用-kafka-桥接插件"}},[s._v("#")]),s._v(" 启用 Kafka 桥接插件")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("./bin/emqx_ctl plugins load emqx_bridge_kafka\n")])])]),t("h2",{attrs:{id:"rabbitmq-桥接"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#rabbitmq-桥接"}},[s._v("#")]),s._v(" RabbitMQ 桥接")]),s._v(" "),t("p",[s._v("EMQ X 桥接转发 MQTT 消息到 RabbitMQ 集群:")]),s._v(" "),t("p",[t("img",{attrs:{src:"http://dgiot-1253666439.cos.ap-shanghai-fsi.myqcloud.com/shuwa_tech/zh/backend/emqx/bridge/assets/bridge_rabbit.png",alt:"bridge_rabbit.png"}})]),s._v(" "),t("p",[s._v("RabbitMQ 桥接插件配置文件: etc/plugins/emqx_bridge_rabbit.conf。")]),s._v(" "),t("h3",{attrs:{id:"配置-rabbitmq-桥接地址"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#配置-rabbitmq-桥接地址"}},[s._v("#")]),s._v(" 配置 RabbitMQ 桥接地址")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## RabbitMQ 的服务器地址")]),s._v("\nbridge.rabbit.1.server "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:5672\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## RabbitMQ 的连接池大小")]),s._v("\nbridge.rabbit.1.pool_size "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## RabbitMQ 的用户名")]),s._v("\nbridge.rabbit.1.username "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" guest\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## RabbitMQ 的密码")]),s._v("\nbridge.rabbit.1.password "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" guest\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## RabbitMQ 的虚拟 Host")]),s._v("\nbridge.rabbit.1.virtual_host "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" /\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## RabbitMQ 的心跳间隔")]),s._v("\nbridge.rabbit.1.heartbeat "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# bridge.rabbit.2.server = 127.0.0.1:5672")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# bridge.rabbit.2.pool_size = 8")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# bridge.rabbit.2.username = guest")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# bridge.rabbit.2.password = guest")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# bridge.rabbit.2.virtual_host = /")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# bridge.rabbit.2.heartbeat = 0")]),s._v("\n")])])]),t("h3",{attrs:{id:"配置-rabbitmq-桥接规则"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#配置-rabbitmq-桥接规则"}},[s._v("#")]),s._v(" 配置 RabbitMQ 桥接规则")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## Bridge Hooks")]),s._v("\nbridge.rabbit.hook.client.subscribe.1 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"action"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"on_client_subscribe"')]),s._v(", "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"rabbit"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(", "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"exchange"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"direct:emq.subscription"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\nbridge.rabbit.hook.client.unsubscribe.1 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"action"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"on_client_unsubscribe"')]),s._v(", "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"rabbit"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(", "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"exchange"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"direct:emq.unsubscription"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\nbridge.rabbit.hook.message.publish.1 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"topic"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$SYS")]),s._v('/#"')]),s._v(", "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"action"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"on_message_publish"')]),s._v(", "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"rabbit"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(", "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"exchange"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"topic:emq.'),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$sys")]),s._v('"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\nbridge.rabbit.hook.message.publish.2 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"topic"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"#"')]),s._v(", "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"action"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"on_message_publish"')]),s._v(", "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"rabbit"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(", "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"exchange"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"topic:emq.pub"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\nbridge.rabbit.hook.message.acked.1 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"topic"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"#"')]),s._v(", "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"action"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"on_message_acked"')]),s._v(", "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"rabbit"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(", "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"exchange"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"topic:emq.acked"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])])]),t("h3",{attrs:{id:"客户端订阅主题事件转发-rabbitmq"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#客户端订阅主题事件转发-rabbitmq"}},[s._v("#")]),s._v(" 客户端订阅主题事件转发 RabbitMQ")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("routing_key "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" subscribe\nexchange "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" emq.subscription\nheaders "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<<")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"x-emq-client-id"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),s._v(", binary, ClientId"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\npayload "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" jsx:encode"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("Topic, proplists:get_value"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("qos, Opts"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("||")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("Topic, Opts"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("- TopicTable"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])])]),t("h3",{attrs:{id:"客户端取消订阅事件转发-rabbitmq"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#客户端取消订阅事件转发-rabbitmq"}},[s._v("#")]),s._v(" 客户端取消订阅事件转发 RabbitMQ")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("routing_key "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" unsubscribe\nexchange "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" emq.unsubscription\nheaders "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<<")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"x-emq-client-id"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),s._v(", binary, ClientId"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\npayload "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" jsx:encode"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("Topic "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("||")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("Topic, _Opts"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("- TopicTable"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(",\n")])])]),t("h3",{attrs:{id:"mqtt-消息转发-rabbitmq"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#mqtt-消息转发-rabbitmq"}},[s._v("#")]),s._v(" MQTT 消息转发 RabbitMQ")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("routing_key "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" binary:replace"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("binary:replace"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("Topic, "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<<")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),s._v(", "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<<")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"."')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),s._v(", "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("global"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(","),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<<")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"+"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),s._v(", "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<<")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"*"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),s._v(", "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("global"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nexchange "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" emq."),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$sys")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" emq.pub\nheaders "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<<")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"x-emq-publish-qos"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),s._v(", byte, Qos"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(",\n           "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<<")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"x-emq-client-id"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),s._v(", binary, pub_from"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("From"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(",\n           "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<<")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"x-emq-publish-msgid"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),s._v(", binary, emqx_base62:encode"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("Id"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(",\n           "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<<")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"x-emqx-topic"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),s._v(", binary, Topic"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\npayload "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" Payload\n")])])]),t("h3",{attrs:{id:"mqtt-消息确认-ack-事件转发-rabbitmq"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#mqtt-消息确认-ack-事件转发-rabbitmq"}},[s._v("#")]),s._v(" MQTT 消息确认 (Ack) 事件转发 RabbitMQ")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("routing_key "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" puback\nexchange "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" emq.acked\nheaders "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<<")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"x-emq-msg-acked"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),s._v(", binary, ClientId"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(",\npayload "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" emqx_base62:encode"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("Id"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])])]),t("h3",{attrs:{id:"rabbitmq-订阅消费-mqtt-消息示例"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#rabbitmq-订阅消费-mqtt-消息示例"}},[s._v("#")]),s._v(" RabbitMQ 订阅消费 MQTT 消息示例")]),s._v(" "),t("p",[s._v("Python RabbitMQ消费者代码示例:")]),s._v(" "),t("div",{staticClass:"language-python extra-class"},[t("pre",{pre:!0,attrs:{class:"language-python"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#!/usr/bin/env python")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" pika\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" sys\n\nconnection "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" pika"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("BlockingConnection"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("pika"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("ConnectionParameters"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("host"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'localhost'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nchannel "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" connection"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("channel"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\nchannel"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("exchange_declare"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("exchange"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'direct:emq.subscription'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" exchange_type"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'direct'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\nresult "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" channel"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("queue_declare"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("exclusive"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("True")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nqueue_name "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" result"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("method"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("queue\n\nchannel"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("queue_bind"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("exchange"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'direct:emq.subscription'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" queue"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("queue_name"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" routing_key"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'subscribe'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("def")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("callback")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("ch"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" method"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" properties"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" body"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("print")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('" [x] %r:%r"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("%")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("method"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("routing_key"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" body"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\nchannel"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("basic_consume"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("callback"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" queue"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("queue_name"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" no_ack"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("True")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\nchannel"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("start_consuming"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])])]),t("p",[s._v("其他语言 RabbitMQ 客户端代码示例:")]),s._v(" "),t("p",[t("a",{attrs:{href:"https://github.com/rabbitmq/rabbitmq-tutorials",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://github.com/rabbitmq/rabbitmq-tutorials"),t("OutboundLink")],1)]),s._v(" "),t("h3",{attrs:{id:"启用-rabbitmq-桥接插件"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#启用-rabbitmq-桥接插件"}},[s._v("#")]),s._v(" 启用 RabbitMQ 桥接插件")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("./bin/emqx_ctl plugins load emqx_bridge_rabbit\n")])])]),t("h2",{attrs:{id:"pulsar-桥接"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#pulsar-桥接"}},[s._v("#")]),s._v(" Pulsar 桥接")]),s._v(" "),t("p",[s._v("EMQ X 桥接转发 MQTT 消息到 Pulsar 集群:")]),s._v(" "),t("p",[t("img",{attrs:{src:"http://dgiot-1253666439.cos.ap-shanghai-fsi.myqcloud.com/shuwa_tech/zh/backend/emqx/bridge/assets/bridge_pulsar.png",alt:"bridge_pulsar.png"}})]),s._v(" "),t("p",[s._v("Pulsar 桥接插件配置文件: etc/plugins/emqx_bridge_pulsar.conf。")]),s._v(" "),t("h3",{attrs:{id:"配置-pulsar-集群地址"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#配置-pulsar-集群地址"}},[s._v("#")]),s._v(" 配置 Pulsar 集群地址")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## Pulsar 服务器集群配置")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## bridge.pulsar.servers = 127.0.0.1:6650,127.0.0.2:6650,127.0.0.3:6650")]),s._v("\nbridge.pulsar.servers "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:6650\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 分区生产者是同步/异步模式选择")]),s._v("\nbridge.pulsar.produce "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sync")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 生产者同步模式下的超时时间")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## bridge.pulsar.produce.sync_timeout = 3s")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 生产者 batch 的消息数量")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## bridge.pulsar.producer.batch_size = 1000")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 默认情况下不为生产者启用压缩选项")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## bridge.pulsar.producer.compression = no_compression")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 采用 base64 编码或不编码")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## bridge.pulsar.encode_payload_type = base64")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## bridge.pulsar.sock.buffer = 32KB")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## bridge.pulsar.sock.recbuf = 32KB")]),s._v("\nbridge.pulsar.sock.sndbuf "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" 1MB\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## bridge.pulsar.sock.read_packets = 20")]),s._v("\n")])])]),t("h3",{attrs:{id:"配置-pulsar-桥接规则"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#配置-pulsar-桥接规则"}},[s._v("#")]),s._v(" 配置 Pulsar 桥接规则")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## Bridge Pulsar Hooks")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## ${topic}: the pulsar topics to which the messages will be published.")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## ${filter}: the mqtt topic (may contain wildcard) on which the action will be performed .")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## Client Connected Record Hook")]),s._v("\nbridge.pulsar.hook.client.connected.1     "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"topic"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"client_connected"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## Client Disconnected Record Hook")]),s._v("\nbridge.pulsar.hook.client.disconnected.1  "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"topic"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"client_disconnected"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## Session Subscribed Record Hook")]),s._v("\nbridge.pulsar.hook.session.subscribed.1   "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"filter"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"#"')]),s._v(",  "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"topic"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"session_subscribed"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## Session Unsubscribed Record Hook")]),s._v("\nbridge.pulsar.hook.session.unsubscribed.1 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"filter"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"#"')]),s._v(",  "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"topic"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"session_unsubscribed"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## Message Publish Record Hook")]),s._v("\nbridge.pulsar.hook.message.publish.1      "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"filter"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"#"')]),s._v(",  "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"topic"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"message_publish"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## Message Delivered Record Hook")]),s._v("\nbridge.pulsar.hook.message.delivered.1    "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"filter"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"#"')]),s._v(",  "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"topic"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"message_delivered"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## Message Acked Record Hook")]),s._v("\nbridge.pulsar.hook.message.acked.1        "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"filter"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"#"')]),s._v(",  "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"topic"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"message_acked"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## More Configures")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## partitioner strategy:")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## Option:  random | roundrobin | first_key_dispatch")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v('## Example: bridge.pulsar.hook.message.publish.1 = {"filter":"#", "topic":"message_publish", "strategy":"random"}')]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## key:")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## Option: ${clientid} | ${username}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v('## Example: bridge.pulsar.hook.message.publish.1 = {"filter":"#", "topic":"message_publish", "key":"${clientid}"}')]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## format:")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## Option: json | json")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v('## Example: bridge.pulsar.hook.message.publish.1 = {"filter":"#", "topic":"message_publish", "format":"json"}')]),s._v("\n")])])]),t("h3",{attrs:{id:"pulsar-桥接规则说明"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#pulsar-桥接规则说明"}},[s._v("#")]),s._v(" Pulsar 桥接规则说明")]),s._v(" "),t("table",{staticStyle:{width:"85%"}},[t("colgroup",[t("col",{staticStyle:{width:"58%"}}),s._v(" "),t("col",{staticStyle:{width:"26%"}})]),s._v(" "),t("thead",[t("tr",{staticClass:"header"},[t("th",[s._v("事件")]),s._v(" "),t("th",[s._v("说明")])])]),s._v(" "),t("tbody",[t("tr",{staticClass:"odd"},[t("td",[s._v("bridge.pulsar.hook.client.connected.1")]),s._v(" "),t("td",[t("div",{staticClass:"line-block"},[s._v("客户端登录")])])]),s._v(" "),t("tr",{staticClass:"even"},[t("td",[s._v("bridge.pulsar.hook.client.disconnected.1")]),s._v(" "),t("td",[t("div",{staticClass:"line-block"},[s._v("客户端退出")])])]),s._v(" "),t("tr",{staticClass:"odd"},[t("td",[s._v("bridge.pulsar.hook.session.subscribed.1")]),s._v(" "),t("td",[t("div",{staticClass:"line-block"},[s._v("订阅主题")])])]),s._v(" "),t("tr",{staticClass:"even"},[t("td",[s._v("bridge.pulsar.hook.session.unsubscribed.1")]),s._v(" "),t("td",[t("div",{staticClass:"line-block"},[s._v("取消订阅主题    ")])])]),s._v(" "),t("tr",{staticClass:"odd"},[t("td",[s._v("bridge.pulsar.hook.message.publish.1")]),s._v(" "),t("td",[t("div",{staticClass:"line-block"},[s._v("发布消息")])])]),s._v(" "),t("tr",{staticClass:"even"},[t("td",[s._v("bridge.pulsar.hook.message.delivered.1")]),s._v(" "),t("td",[t("div",{staticClass:"line-block"},[s._v("delivered 消息")])])]),s._v(" "),t("tr",{staticClass:"odd"},[t("td",[s._v("bridge.pulsar.hook.message.acked.1")]),s._v(" "),t("td",[t("div",{staticClass:"line-block"},[s._v("ACK 消息")])])])])]),s._v(" "),t("h3",{attrs:{id:"客户端上下线事件转发-pulsar"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#客户端上下线事件转发-pulsar"}},[s._v("#")]),s._v(" 客户端上下线事件转发 Pulsar")]),s._v(" "),t("p",[s._v("设备上线 EMQ X 转发上线事件消息到 Pulsar:")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("topic "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"client_connected"')]),s._v(",\nvalue "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n         "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"client_id"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${clientid}")]),s._v(",\n         "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"username"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${username}")]),s._v(",\n         "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"node"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${node}")]),s._v(",\n         "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"ts"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${ts}")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])])]),t("p",[s._v("设备下线 EMQ X 转发下线事件消息到 Pulsar:")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("topic "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"client_disconnected"')]),s._v(",\nvalue "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n         "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"client_id"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${clientid}")]),s._v(",\n         "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"username"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${username}")]),s._v(",\n         "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"reason"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${reason}")]),s._v(",\n         "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"node"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${node}")]),s._v(",\n         "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"ts"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${ts}")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])])]),t("h3",{attrs:{id:"客户端订阅主题事件转发-pulsar"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#客户端订阅主题事件转发-pulsar"}},[s._v("#")]),s._v(" 客户端订阅主题事件转发 Pulsar")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("topic "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" session_subscribed\n\nvalue "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n         "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"client_id"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${clientid}")]),s._v(",\n         "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"topic"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${topic}")]),s._v(",\n         "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"qos"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${qos}")]),s._v(",\n         "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"node"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${node}")]),s._v(",\n         "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"ts"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${timestamp}")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])])]),t("h3",{attrs:{id:"客户端取消订阅主题事件转发-pulsar"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#客户端取消订阅主题事件转发-pulsar"}},[s._v("#")]),s._v(" 客户端取消订阅主题事件转发 Pulsar")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("topic "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" session_unsubscribed\n\nvalue "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n         "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"client_id"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${clientid}")]),s._v(",\n         "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"topic"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${topic}")]),s._v(",\n         "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"qos"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${qos}")]),s._v(",\n         "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"node"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${node}")]),s._v(",\n         "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"ts"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${timestamp}")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])])]),t("h3",{attrs:{id:"mqtt-消息转发到-pulsar"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#mqtt-消息转发到-pulsar"}},[s._v("#")]),s._v(" MQTT 消息转发到 Pulsar")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("topic "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" message_publish\n\nvalue "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n         "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"client_id"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${clientid}")]),s._v(",\n         "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"username"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${username}")]),s._v(",\n         "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"topic"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${topic}")]),s._v(",\n         "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"payload"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${payload}")]),s._v(",\n         "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"qos"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${qos}")]),s._v(",\n         "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"node"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${node}")]),s._v(",\n         "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"ts"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${timestamp}")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])])]),t("h3",{attrs:{id:"mqtt-消息派发-deliver-事件转发-pulsar"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#mqtt-消息派发-deliver-事件转发-pulsar"}},[s._v("#")]),s._v(" MQTT 消息派发 (Deliver) 事件转发 Pulsar")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("topic "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" message_delivered\n\nvalue "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n         "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"client_id"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${clientid}")]),s._v(",\n         "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"username"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${username}")]),s._v(",\n         "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"from"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${fromClientId}")]),s._v(",\n         "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"topic"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${topic}")]),s._v(",\n         "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"payload"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${payload}")]),s._v(",\n         "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"qos"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${qos}")]),s._v(",\n         "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"node"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${node}")]),s._v(",\n         "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"ts"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${timestamp}")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])])]),t("h3",{attrs:{id:"mqtt-消息确认-ack-事件转发-pulsar"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#mqtt-消息确认-ack-事件转发-pulsar"}},[s._v("#")]),s._v(" MQTT 消息确认 (Ack) 事件转发 Pulsar")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("topic "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" message_acked\n\nvalue "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n         "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"client_id"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${clientid}")]),s._v(",\n         "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"username"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${username}")]),s._v(",\n         "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"from"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${fromClientId}")]),s._v(",\n         "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"topic"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${topic}")]),s._v(",\n         "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"payload"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${payload}")]),s._v(",\n         "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"qos"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${qos}")]),s._v(",\n         "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"node"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${node}")]),s._v(",\n         "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"ts"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${timestamp}")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])])]),t("h3",{attrs:{id:"pulsar-消费示例"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#pulsar-消费示例"}},[s._v("#")]),s._v(" Pulsar 消费示例")]),s._v(" "),t("p",[s._v("Pulsar 读取 MQTT 客户端上下线事件消息:")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("pulsar-client consume client_connected  -s "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"client_connected"')]),s._v(" -n "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000")]),s._v("\n\npulsar-client consume client_disconnected  -s "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"client_disconnected"')]),s._v(" -n "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000")]),s._v("\n")])])]),t("p",[s._v("Pulsar 读取 MQTT 主题订阅事件消息:")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("pulsar-client consume session_subscribed  -s "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"session_subscribed"')]),s._v(" -n "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000")]),s._v("\n\npulsar-client consume session_unsubscribed  -s "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"session_unsubscribed"')]),s._v(" -n "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000")]),s._v("\n")])])]),t("p",[s._v("Pulsar 读取 MQTT 发布消息:")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("pulsar-client consume message_publish  -s "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"message_publish"')]),s._v(" -n "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000")]),s._v("\n")])])]),t("p",[s._v("Pulsar 读取 MQTT 消息发布 (Deliver)、确认 (Ack)事件:")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("pulsar-client consume message_delivered  -s "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"message_delivered"')]),s._v(" -n "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000")]),s._v("\n\npulsar-client consume message_acked  -s "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"message_acked"')]),s._v(" -n "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000")]),s._v("\n")])])]),t("div",{staticClass:"custom-block tip"},[t("p",{staticClass:"custom-block-title"},[s._v("提示")]),s._v(" "),t("p",[s._v("默认 payload 被 base64 编码，可通过修改配置 bridge.pulsar.encode_payload_type 指定 payload 数据格式。")])]),s._v(" "),t("h3",{attrs:{id:"启用-pulsar-桥接插件"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#启用-pulsar-桥接插件"}},[s._v("#")]),s._v(" 启用 Pulsar 桥接插件")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("./bin/emqx_ctl plugins load emqx_bridge_pulsar\n")])])]),t("h2",{attrs:{id:"rocketmq-桥接"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#rocketmq-桥接"}},[s._v("#")]),s._v(" RocketMQ 桥接")]),s._v(" "),t("p",[s._v("EMQ X 桥接转发 MQTT 消息到 RocketMQ 集群:")]),s._v(" "),t("p",[t("img",{attrs:{src:"http://dgiot-1253666439.cos.ap-shanghai-fsi.myqcloud.com/shuwa_tech/zh/backend/emqx/bridge/assets/bridge_rocket.png",alt:"bridge_rocket.png"}})]),s._v(" "),t("p",[s._v("RocketMQ 桥接插件配置文件: etc/plugins/emqx_bridge_rocket.conf。")]),s._v(" "),t("h3",{attrs:{id:"配置-rocketmq-集群地址"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#配置-rocketmq-集群地址"}},[s._v("#")]),s._v(" 配置 RocketMQ 集群地址")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## RocketMQ 服务器集群配置")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## bridge.rocket.servers = 127.0.0.1:9876,127.0.0.2:9876,127.0.0.3:9876")]),s._v("\nbridge.rocket.servers "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:9876\n\nbridge.rocket.refresh_topic_route_interval "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" 5S\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 分区生产者是同步/异步模式选择")]),s._v("\nbridge.rocket.produce "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sync")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 生产者同步模式下的超时时间")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## bridge.rocket.produce.sync_timeout = 3s")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 生产者 batch 的消息数量")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## bridge.rocket.producer.batch_size = 100")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 采用 base64 编码或不编码")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## bridge.rocket.encode_payload_type = base64")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## bridge.rocket.sock.buffer = 32KB")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## bridge.rocket.sock.recbuf = 32KB")]),s._v("\nbridge.rocket.sock.sndbuf "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" 1MB\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## bridge.rocket.sock.read_packets = 20")]),s._v("\n")])])]),t("h3",{attrs:{id:"配置-rocketmq-桥接规则"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#配置-rocketmq-桥接规则"}},[s._v("#")]),s._v(" 配置 RocketMQ 桥接规则")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## Bridge RocketMQ Hooks")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## ${topic}: the RocketMQ topics to which the messages will be published.")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## ${filter}: the mqtt topic (may contain wildcard) on which the action will be performed .")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## Client Connected Record Hook")]),s._v("\nbridge.rocket.hook.client.connected.1     "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"topic"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"ClientConnected"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## Client Disconnected Record Hook")]),s._v("\nbridge.rocket.hook.client.disconnected.1  "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"topic"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"ClientDisconnected"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## Session Subscribed Record Hook")]),s._v("\nbridge.rocket.hook.session.subscribed.1   "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"filter"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"#"')]),s._v(",  "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"topic"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"SessionSubscribed"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## Session Unsubscribed Record Hook")]),s._v("\nbridge.rocket.hook.session.unsubscribed.1 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"filter"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"#"')]),s._v(",  "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"topic"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"SessionUnsubscribed"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## Message Publish Record Hook")]),s._v("\nbridge.rocket.hook.message.publish.1      "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"filter"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"#"')]),s._v(",  "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"topic"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"MessagePublish"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## Message Delivered Record Hook")]),s._v("\nbridge.rocket.hook.message.delivered.1    "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"filter"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"#"')]),s._v(",  "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"topic"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"MessageDeliver"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## Message Acked Record Hook")]),s._v("\nbridge.rocket.hook.message.acked.1        "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"filter"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"#"')]),s._v(",  "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"topic"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"MessageAcked"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])])]),t("h3",{attrs:{id:"rocketmq-桥接规则说明"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#rocketmq-桥接规则说明"}},[s._v("#")]),s._v(" RocketMQ 桥接规则说明")]),s._v(" "),t("table",{staticStyle:{width:"85%"}},[t("colgroup",[t("col",{staticStyle:{width:"58%"}}),s._v(" "),t("col",{staticStyle:{width:"26%"}})]),s._v(" "),t("thead",[t("tr",{staticClass:"header"},[t("th",[s._v("事件")]),s._v(" "),t("th",[s._v("说明")])])]),s._v(" "),t("tbody",[t("tr",{staticClass:"odd"},[t("td",[s._v("bridge.rocket.hook.client.connected.1")]),s._v(" "),t("td",[t("div",{staticClass:"line-block"},[s._v("客户端登录")])])]),s._v(" "),t("tr",{staticClass:"even"},[t("td",[s._v("bridge.rocket.hook.client.disconnected.1")]),s._v(" "),t("td",[t("div",{staticClass:"line-block"},[s._v("客户端退出")])])]),s._v(" "),t("tr",{staticClass:"odd"},[t("td",[s._v("bridge.rocket.hook.session.subscribed.1")]),s._v(" "),t("td",[t("div",{staticClass:"line-block"},[s._v("订阅主题")])])]),s._v(" "),t("tr",{staticClass:"even"},[t("td",[s._v("bridge.rocket.hook.session.unsubscribed.1")]),s._v(" "),t("td",[t("div",{staticClass:"line-block"},[s._v("取消订阅主题    ")])])]),s._v(" "),t("tr",{staticClass:"odd"},[t("td",[s._v("bridge.rocket.hook.message.publish.1")]),s._v(" "),t("td",[t("div",{staticClass:"line-block"},[s._v("发布消息")])])]),s._v(" "),t("tr",{staticClass:"even"},[t("td",[s._v("bridge.rocket.hook.message.delivered.1")]),s._v(" "),t("td",[t("div",{staticClass:"line-block"},[s._v("delivered 消息")])])]),s._v(" "),t("tr",{staticClass:"odd"},[t("td",[s._v("bridge.rocket.hook.message.acked.1")]),s._v(" "),t("td",[t("div",{staticClass:"line-block"},[s._v("ACK 消息")])])])])]),s._v(" "),t("h3",{attrs:{id:"客户端上下线事件转发-rocketmq"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#客户端上下线事件转发-rocketmq"}},[s._v("#")]),s._v(" 客户端上下线事件转发 RocketMQ")]),s._v(" "),t("p",[s._v("设备上线 EMQ X 转发上线事件消息到 RocketMQ:")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("topic "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"ClientConnected"')]),s._v(",\nvalue "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n         "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"client_id"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${clientid}")]),s._v(",\n         "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"username"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${username}")]),s._v(",\n         "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"node"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${node}")]),s._v(",\n         "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"ts"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${ts}")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])])]),t("p",[s._v("设备下线 EMQ X 转发下线事件消息到 RocketMQ:")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("topic "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"ClientDisconnected"')]),s._v(",\nvalue "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n         "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"client_id"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${clientid}")]),s._v(",\n         "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"username"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${username}")]),s._v(",\n         "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"reason"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${reason}")]),s._v(",\n         "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"node"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${node}")]),s._v(",\n         "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"ts"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${ts}")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])])]),t("h3",{attrs:{id:"客户端订阅主题事件转发-rocketmq"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#客户端订阅主题事件转发-rocketmq"}},[s._v("#")]),s._v(" 客户端订阅主题事件转发 RocketMQ")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("topic "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"SessionSubscribed"')]),s._v("\n\nvalue "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n         "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"client_id"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${clientid}")]),s._v(",\n         "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"topic"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${topic}")]),s._v(",\n         "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"qos"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${qos}")]),s._v(",\n         "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"node"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${node}")]),s._v(",\n         "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"ts"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${timestamp}")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])])]),t("h3",{attrs:{id:"客户端取消订阅主题事件转发-rocketmq"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#客户端取消订阅主题事件转发-rocketmq"}},[s._v("#")]),s._v(" 客户端取消订阅主题事件转发 RocketMQ")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("topic "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"SessionUnsubscribed"')]),s._v("\n\nvalue "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n         "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"client_id"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${clientid}")]),s._v(",\n         "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"topic"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${topic}")]),s._v(",\n         "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"qos"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${qos}")]),s._v(",\n         "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"node"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${node}")]),s._v(",\n         "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"ts"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${timestamp}")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])])]),t("h3",{attrs:{id:"mqtt-消息转发到-rocketmq"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#mqtt-消息转发到-rocketmq"}},[s._v("#")]),s._v(" MQTT 消息转发到 RocketMQ")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("topic "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"MessagePublish"')]),s._v("\n\nvalue "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n         "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"client_id"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${clientid}")]),s._v(",\n         "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"username"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${username}")]),s._v(",\n         "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"topic"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${topic}")]),s._v(",\n         "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"payload"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${payload}")]),s._v(",\n         "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"qos"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${qos}")]),s._v(",\n         "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"node"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${node}")]),s._v(",\n         "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"ts"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${timestamp}")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])])]),t("h3",{attrs:{id:"mqtt-消息派发-deliver-事件转发-rocketmq"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#mqtt-消息派发-deliver-事件转发-rocketmq"}},[s._v("#")]),s._v(" MQTT 消息派发 (Deliver) 事件转发 RocketMQ")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("topic "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"MessageDeliver"')]),s._v("\n\nvalue "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n         "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"client_id"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${clientid}")]),s._v(",\n         "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"username"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${username}")]),s._v(",\n         "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"from"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${fromClientId}")]),s._v(",\n         "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"topic"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${topic}")]),s._v(",\n         "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"payload"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${payload}")]),s._v(",\n         "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"qos"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${qos}")]),s._v(",\n         "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"node"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${node}")]),s._v(",\n         "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"ts"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${timestamp}")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])])]),t("h3",{attrs:{id:"mqtt-消息确认-ack-事件转发-rocketmq"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#mqtt-消息确认-ack-事件转发-rocketmq"}},[s._v("#")]),s._v(" MQTT 消息确认 (Ack) 事件转发 RocketMQ")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("topic "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"MessageAcked"')]),s._v("\n\nvalue "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n         "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"client_id"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${clientid}")]),s._v(",\n         "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"username"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${username}")]),s._v(",\n         "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"from"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${fromClientId}")]),s._v(",\n         "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"topic"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${topic}")]),s._v(",\n         "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"payload"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${payload}")]),s._v(",\n         "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"qos"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${qos}")]),s._v(",\n         "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"node"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${node}")]),s._v(",\n         "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"ts"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${timestamp}")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])])]),t("h3",{attrs:{id:"rocketmq-消费示例"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#rocketmq-消费示例"}},[s._v("#")]),s._v(" RocketMQ 消费示例")]),s._v(" "),t("p",[s._v("RocketMQ 读取 MQTT 客户端上下线事件消息:")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("bin/tools.sh org.apache.rocketmq.example.quickstart.Consumer ClientConnected\n  \nbin/tools.sh org.apache.rocketmq.example.quickstart.Consumer ClientDisconnected\n")])])]),t("p",[s._v("RocketMQ 读取 MQTT 主题订阅事件消息:")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("bin/tools.sh org.apache.rocketmq.example.quickstart.Consumer SessionSubscribed\n\nbin/tools.sh org.apache.rocketmq.example.quickstart.Consumer SessionUnsubscribed\n")])])]),t("p",[s._v("RocketMQ 读取 MQTT 发布消息:")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("bin/tools.sh org.apache.rocketmq.example.quickstart.Consumer MessagePublish\n")])])]),t("p",[s._v("RocketMQ 读取 MQTT 消息发布 (Deliver)、确认 (Ack) 事件:")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("bin/tools.sh org.apache.rocketmq.example.quickstart.Consumer MessageDeliver\n\nbin/tools.sh org.apache.rocketmq.example.quickstart.Consumer MessageAcked\n")])])]),t("div",{staticClass:"custom-block tip"},[t("p",{staticClass:"custom-block-title"},[s._v("提示")]),s._v(" "),t("p",[s._v("默认 payload 被 base64 编码，可通过修改配置 bridge.rocket.encode_payload_type 指定\npayload 数据格式。")])]),s._v(" "),t("h3",{attrs:{id:"启用-rocketmq-桥接插件"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#启用-rocketmq-桥接插件"}},[s._v("#")]),s._v(" 启用 RocketMQ 桥接插件")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("./bin/emqx_ctl plugins load emqx_bridge_rocket\n")])])])])}),[],!1,null,null,null);a.default=n.exports}}]);