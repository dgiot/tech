(window.webpackJsonp=window.webpackJsonp||[]).push([[84],{779:function(_,t,a){"use strict";a.r(t);var v=a(8),e=Object(v.a)({},(function(){var _=this,t=_.$createElement,a=_._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":_.$parent.slotKey}},[a("h1",{attrs:{id:"数据存储"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#数据存储"}},[_._v("#")]),_._v(" 数据存储")]),_._v(" "),a("p",[_._v("数据存储的主要使用场景包括将客户端上下线状态，订阅主题信息，消息内容，消息抵达后发送消息回执等操作记录到 Redis、MySQL、PostgreSQL、MongoDB、Cassandra 等各种数据库中。用户也可以通过订阅相关主题的方式来实现类似的功能，但是在企业版中内置了对这些持久化的支持；相比于前者，后者的执行效率更高，也能大大降低开发者的工作量。")]),_._v(" "),a("div",{staticClass:"custom-block danger"},[a("p",{staticClass:"custom-block-title"},[_._v("警告")]),_._v(" "),a("p",[_._v("数据存储是 EMQ X Enterprise 专属功能。")])]),_._v(" "),a("h2",{attrs:{id:"数据存储设计"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#数据存储设计"}},[_._v("#")]),_._v(" 数据存储设计")]),_._v(" "),a("h3",{attrs:{id:"一对一消息存储"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#一对一消息存储"}},[_._v("#")]),_._v(" 一对一消息存储")]),_._v(" "),a("p",[a("img",{attrs:{src:"http://dgiot-1253666439.cos.ap-shanghai-fsi.myqcloud.com/develop_png/zh_CN/backend/assets/backends_1.png",alt:"backends_1.png"}})]),_._v(" "),a("ol",[a("li",[_._v("Publish 端发布一条消息；")]),_._v(" "),a("li",[_._v("Backend 将消息记录数据库中；")]),_._v(" "),a("li",[_._v("Subscribe 端订阅主题；")]),_._v(" "),a("li",[_._v("Backend 从数据库中获取该主题的消息；")]),_._v(" "),a("li",[_._v("发送消息给 Subscribe 端；")]),_._v(" "),a("li",[_._v("Subscribe 端确认后 Backend 从数据库中移除该消息；")])]),_._v(" "),a("h3",{attrs:{id:"一对多消息存储"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#一对多消息存储"}},[_._v("#")]),_._v(" 一对多消息存储")]),_._v(" "),a("p",[a("img",{attrs:{src:"http://dgiot-1253666439.cos.ap-shanghai-fsi.myqcloud.com/develop_png/zh_CN/backend/assets/backends_2.png",alt:"backends_2.png"}})]),_._v(" "),a("ol",[a("li",[_._v("Publish 端发布一条消息；")]),_._v(" "),a("li",[_._v("Backend 将消息记录在数据库中；")]),_._v(" "),a("li",[_._v("Subscribe1 和 Subscribe2 订阅主题；")]),_._v(" "),a("li",[_._v("Backend 从数据库中获取该主题的消息；")]),_._v(" "),a("li",[_._v("发送消息给 Subscribe1 和 Subscribe2；")]),_._v(" "),a("li",[_._v("Backend 记录 Subscribe1 和 Subscribe2 已读消息位置，下次获取消息从该位置开始。")])]),_._v(" "),a("h3",{attrs:{id:"客户端在线状态存储"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#客户端在线状态存储"}},[_._v("#")]),_._v(" 客户端在线状态存储")]),_._v(" "),a("p",[_._v("支持将设备上下线状态，直接存储到 Redis 或数据库。")]),_._v(" "),a("h3",{attrs:{id:"客户端代理订阅"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#客户端代理订阅"}},[_._v("#")]),_._v(" 客户端代理订阅")]),_._v(" "),a("p",[_._v("支持代理订阅功能，设备客户端上线时，由存储模块直接从数据库，代理加载订阅主题。")]),_._v(" "),a("h3",{attrs:{id:"存储插件列表"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#存储插件列表"}},[_._v("#")]),_._v(" 存储插件列表")]),_._v(" "),a("p",[_._v("EMQ X 支持 MQTT 消息直接存储 Redis、MySQL、PostgreSQL、MongoDB、Cassandra、DynamoDB、InfluxDB、OpenTSDB 数据库:")]),_._v(" "),a("table",[a("thead",[a("tr",[a("th",[_._v("存储插件")]),_._v(" "),a("th",[_._v("配置文件")]),_._v(" "),a("th",[_._v("说明")])])]),_._v(" "),a("tbody",[a("tr",[a("td",[_._v("emqx_backend_redis")]),_._v(" "),a("td",[_._v("emqx_backend_redis.conf")]),_._v(" "),a("td",[_._v("Redis 消息存储")])]),_._v(" "),a("tr",[a("td",[_._v("emqx_backend_mysql")]),_._v(" "),a("td",[_._v("emqx_backend_mysql.conf")]),_._v(" "),a("td",[_._v("MySQL 消息存储")])]),_._v(" "),a("tr",[a("td",[_._v("emqx_backend_pgsql")]),_._v(" "),a("td",[_._v("emqx_backend_pgsql.conf")]),_._v(" "),a("td",[_._v("PostgreSQL 消息存储")])]),_._v(" "),a("tr",[a("td",[_._v("emqx_backend_mongo")]),_._v(" "),a("td",[_._v("emqx_backend_mongo.conf")]),_._v(" "),a("td",[_._v("MongoDB 消息存储")])]),_._v(" "),a("tr",[a("td",[_._v("emqx_backend_cassa")]),_._v(" "),a("td",[_._v("emqx_backend_cassa.conf")]),_._v(" "),a("td",[_._v("Cassandra 消息存储")])]),_._v(" "),a("tr",[a("td",[_._v("emqx_backend_dynamo")]),_._v(" "),a("td",[_._v("emqx_backend_dynamo.conf")]),_._v(" "),a("td",[_._v("DynamoDB 消息存储")])]),_._v(" "),a("tr",[a("td",[_._v("emqx_backend_influxdb")]),_._v(" "),a("td",[_._v("emqx_backend_influxdb.conf")]),_._v(" "),a("td",[_._v("InfluxDB 消息存储")])]),_._v(" "),a("tr",[a("td",[_._v("emqx_backend_opentsdb")]),_._v(" "),a("td",[_._v("emqx_backend_opentsdb.conf")]),_._v(" "),a("td",[_._v("OpenTSDB 消息存储")])])])]),_._v(" "),a("h3",{attrs:{id:"配置步骤"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#配置步骤"}},[_._v("#")]),_._v(" 配置步骤")]),_._v(" "),a("p",[_._v("EMQ X 中支持不同类型的数据库的持久化，虽然在一些细节的配置上有所不同，但是任何一种类型的持久化配置主要做两步操作：")]),_._v(" "),a("ul",[a("li",[_._v("数据源连接配置：这部分主要用于配置数据库的连接信息，包括服务器地址，数据库名称，以及用户名和密码等信息，针对每种不同的数据库，这部分配置可能会有所不同；")]),_._v(" "),a("li",[_._v("事件注册与行为：根据不同的事件，你可以在配置文件中配置相关的行为（action），相关的行为可以是函数，也可以是SQL语句。")])])])}),[],!1,null,null,null);t.default=e.exports}}]);