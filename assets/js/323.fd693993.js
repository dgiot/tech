(window.webpackJsonp=window.webpackJsonp||[]).push([[323],{468:function(s,t,a){"use strict";a.r(t);var n=a(10),r=Object(n.a)({},(function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h4",{attrs:{id:"前提条件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#前提条件"}},[s._v("#")]),s._v(" 前提条件")]),s._v(" "),a("ul",[a("li",[a("p",[s._v("Oracle数据库为11.2.0.4/12.1.0.2或以上版本。")])]),s._v(" "),a("li",[a("p",[s._v("Oracle数据库需具备OGG License（无需安装OGG）。")])]),s._v(" "),a("li",[a("p",[s._v("若Oracle数据库为主备模式，不支持使用Oracle备库。")])])]),s._v(" "),a("h2",{attrs:{id:"一、oracle为非cdb数据库时的配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#一、oracle为非cdb数据库时的配置"}},[s._v("#")]),s._v(" 一、Oracle为非CDB数据库时的配置")]),s._v(" "),a("p",[a("em",[a("strong",[s._v("建议由数据库管理员进行CDC功能的配置操作。")])])]),s._v(" "),a("h3",{attrs:{id:"_1-开启日志归档和xstream。"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-开启日志归档和xstream。"}},[s._v("#")]),s._v(" 1 开启日志归档和XStream。")]),s._v(" "),a("h4",{attrs:{id:"_1-1-在命令行工具中执行以下命令以sys用户连接到数据库。"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-1-在命令行工具中执行以下命令以sys用户连接到数据库。"}},[s._v("#")]),s._v(" 1.1 在命令行工具中执行以下命令以sys用户连接到数据库。")]),s._v(" "),a("p",[s._v("在实际使用过程中，可以有多种方式连接数据库，此处以命令行方式为例进行说明。")]),s._v(" "),a("p",[a("em",[s._v("如果遇到问题，请尝试在数据库所在机器开启日志。")])]),s._v(" "),a("div",{staticClass:"language-javascript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[s._v("sqlplus "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("nolog\n"),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("CONNECT")]),s._v(" sys"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("password@host"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("port "),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("AS")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("SYSDBA")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])]),a("ul",[a("li",[a("p",[a("strong",[s._v("password")])]),s._v(" "),a("p",[s._v("为数据库sys用户的密码，可向数据库管理员获取。")])]),s._v(" "),a("li",[a("p",[a("strong",[s._v("host")])]),s._v(" "),a("p",[s._v("为数据库实例所在服务器的IP地址，请根据实际情况设置。")])]),s._v(" "),a("li",[a("p",[a("strong",[s._v("port")])]),s._v(" "),a("p",[s._v("为数据库实例所使用的端口，请根据实际情况设置。")])])]),s._v(" "),a("h4",{attrs:{id:"_1-2-执行以下命令开启xstream。"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-执行以下命令开启xstream。"}},[s._v("#")]),s._v(" 1.2 执行以下命令开启Xstream。")]),s._v(" "),a("div",{staticClass:"language-javascript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[s._v("alter system "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("set")]),s._v(" enable_goldengate_replication"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])]),a("h4",{attrs:{id:"_1-3-执行以下命令-检查日志归档是否已开启。"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-3-执行以下命令-检查日志归档是否已开启。"}},[s._v("#")]),s._v(" 1.3 执行以下命令，检查日志归档是否已开启。")]),s._v(" "),a("div",{staticClass:"language-javascript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[s._v("archive log list"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])]),a("ul",[a("li",[a("p",[s._v("若回显打印“Database log mode: No Archive Mode”，说明日志归档未开启，继续执行下一步。")])]),s._v(" "),a("li",[a("p",[s._v("若回显打印“Database log mode: Archive Mode”，说明日志归档已开启，直接跳到1.7。")])])]),s._v(" "),a("h4",{attrs:{id:"_1-4-执行以下命令配置归档日志参数。"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-4-执行以下命令配置归档日志参数。"}},[s._v("#")]),s._v(" 1.4 执行以下命令配置归档日志参数。")]),s._v(" "),a("div",{staticClass:"language-javascript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[s._v("alter system "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("set")]),s._v(" db_recovery_file_dest_size "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v("G"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nalter system "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("set")]),s._v(" db_recovery_file_dest "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'/opt/oracle/oradata/recovery_area'")]),s._v(" scope"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("spfile"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])]),a("ul",[a("li",[a("p",[a("strong",[s._v("100G")])]),s._v(" "),a("p",[s._v("为日志文件存储空间的大小，请根据实际情况设置。")])]),s._v(" "),a("li",[a("p",[a("strong",[s._v("/opt/oracle/oradata/recovery_area")])]),s._v(" "),a("p",[s._v("为日志存储路径，请根据实际规划设置，但须确保路径提前创建。")])])]),s._v(" "),a("h4",{attrs:{id:"_1-5-执行以下命令开启日志归档。"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-5-执行以下命令开启日志归档。"}},[s._v("#")]),s._v(" 1.5 执行以下命令开启日志归档。")]),s._v(" "),a("p",[a("strong",[s._v("注意：")])]),s._v(" "),a("ul",[a("li",[a("p",[s._v("开启日志归档功能需重启数据库，重启期间将导致业务中断，请谨慎操作。")])]),s._v(" "),a("li",[a("p",[s._v("归档日志会占用较多的磁盘空间，若磁盘空间满了会影响业务，请定期清理过期归档日志。")])])]),s._v(" "),a("div",{staticClass:"language-javascript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[s._v("shutdown immediate"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nstartup mount"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nalter database archivelog"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nalter database open"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])]),a("h4",{attrs:{id:"_1-6-执行以下命令-确认日志归档是否已成功开启。"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-6-执行以下命令-确认日志归档是否已成功开启。"}},[s._v("#")]),s._v(" 1.6 执行以下命令，确认日志归档是否已成功开启。")]),s._v(" "),a("div",{staticClass:"language-javascript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[s._v("archive log list"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])]),a("p",[s._v("当回显打印“Database log mode: Archive Mode”，说明日志归档已开启。")]),s._v(" "),a("h4",{attrs:{id:"_1-7-执行以下命令退出数据库连接。"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-7-执行以下命令退出数据库连接。"}},[s._v("#")]),s._v(" 1.7 执行以下命令退出数据库连接。")]),s._v(" "),a("div",{staticClass:"language-javascript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[s._v("exit"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])]),a("h3",{attrs:{id:"_2-创建xstream用户并给用户赋予权限。"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-创建xstream用户并给用户赋予权限。"}},[s._v("#")]),s._v(" 2 创建XStream用户并给用户赋予权限。")]),s._v(" "),a("h4",{attrs:{id:"_2-1-在命令行工具中执行以下命令以sys用户连接到数据库实例。"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-在命令行工具中执行以下命令以sys用户连接到数据库实例。"}},[s._v("#")]),s._v(" 2.1 在命令行工具中执行以下命令以sys用户连接到数据库实例。")]),s._v(" "),a("div",{staticClass:"language-javascript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[s._v("sqlplus sys"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("password@host"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("port"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("SID")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("as")]),s._v(" sysdba\n")])])]),a("ul",[a("li",[a("p",[a("strong",[s._v("password")])]),s._v(" "),a("p",[s._v("为数据库sys用户的密码，请向数据库管理员获取。")])]),s._v(" "),a("li",[a("p",[a("strong",[s._v("host")])]),s._v(" "),a("p",[s._v("为数据库实例所在服务器的IP地址，请根据实际情况设置。")])]),s._v(" "),a("li",[a("p",[a("strong",[s._v("port")])]),s._v(" "),a("p",[s._v("为数据库实例所使用的端口，请根据实际情况设置。")])]),s._v(" "),a("li",[a("p",[a("strong",[s._v("SID")])]),s._v(" "),a("p",[s._v("为要同步数据所在实例的实例名，请根据实际情况设置。")])])]),s._v(" "),a("h4",{attrs:{id:"_2-2-执行以下命令创建xstream管理员用户并配置权限。"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-执行以下命令创建xstream管理员用户并配置权限。"}},[s._v("#")]),s._v(" 2.2 执行以下命令创建XStream管理员用户并配置权限。")]),s._v(" "),a("div",{staticClass:"language-javascript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("CREATE")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("TABLESPACE")]),s._v(" xstream_adm_tbs "),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("DATAFILE")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'/opt/oracle/oradata/orcl/xstream_adm_tbs.dbf'")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("SIZE")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("25")]),s._v("M "),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("REUSE")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("AUTOEXTEND")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("ON")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("MAXSIZE")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("UNLIMITED")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("CREATE")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("USER")]),s._v(" xstrmadmin "),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("IDENTIFIED")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("BY")]),s._v(" password "),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("DEFAULT")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("TABLESPACE")]),s._v(" xstream_adm_tbs "),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("QUOTA")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("UNLIMITED")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("ON")]),s._v(" xstream_adm_tbs"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("GRANT")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("CREATE")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("SESSION")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("TO")]),s._v(" xstrmadmin"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("GRANT")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("ALL")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("PRIVILEGES")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("TO")]),s._v(" xstrmadmin"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("BEGIN")]),s._v("\n   "),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("DBMS_XSTREAM_AUTH")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("GRANT_ADMIN_PRIVILEGE")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token parameter"}},[s._v("grantee")]),s._v("                 "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=>")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'xstrmadmin'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token parameter"}},[s._v("privilege_type")]),s._v("          "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=>")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'CAPTURE'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token parameter"}},[s._v("grant_select_privileges")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=>")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("TRUE")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token parameter"}},[s._v("container")]),s._v("             "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=>")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'ALL'")]),s._v("\n   "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("END")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])]),a("ul",[a("li",[a("p",[a("strong",[s._v("xstream_adm_tbs")])]),s._v(" "),a("p",[s._v("为XStream管理员用户的表空间名，请根据实际规划设置。")])]),s._v(" "),a("li",[a("p",[a("strong",[s._v("/opt/oracle/oradata/orcl/xstream_adm_tbs.dbf")])]),s._v(" "),a("p",[s._v("为XStream管理员用户的表空间文件，请根据实际规划设置。")])]),s._v(" "),a("li",[a("p",[a("strong",[s._v("xstrmadmin")])]),s._v(" "),a("p",[s._v("为XStream管理员用户名，请根据实际规划设置。")])]),s._v(" "),a("li",[a("p",[a("strong",[s._v("password")])]),s._v(" "),a("p",[s._v("为XStream管理员用户密码，请根据实际规划设置。")])]),s._v(" "),a("li",[a("p",[s._v("“"),a("strong",[s._v("container => 'ALL'")]),s._v("”仅当Oracle为12c或以上版本时，才需要添加，否则删除此行内容。")])])]),s._v(" "),a("h4",{attrs:{id:"_2-3-执行以下命令创建八爪鱼连接数据库的用户并配置权限。"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-3-执行以下命令创建八爪鱼连接数据库的用户并配置权限。"}},[s._v("#")]),s._v(" 2.3 执行以下命令创建八爪鱼连接数据库的用户并配置权限。")]),s._v(" "),a("div",{staticClass:"language-javascript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("CREATE")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("TABLESPACE")]),s._v(" xstream_tbs "),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("DATAFILE")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'/opt/oracle/oradata/orcl/xstream_tbs.dbf'")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("SIZE")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("25")]),s._v("M "),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("REUSE")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("AUTOEXTEND")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("ON")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("MAXSIZE")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("UNLIMITED")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("CREATE")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("USER")]),s._v(" xstrm "),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("IDENTIFIED")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("BY")]),s._v(" password "),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("DEFAULT")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("TABLESPACE")]),s._v(" xstream_tbs "),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("QUOTA")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("UNLIMITED")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("ON")]),s._v(" xstream_tbs"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("GRANT")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("CREATE")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("SESSION")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("TO")]),s._v(" xstrm"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("GRANT")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("SELECT")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("ON")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("V_")]),s._v("$"),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("DATABASE")]),s._v(" to xstrm"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("GRANT")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("FLASHBACK")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("ANY")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("TABLE")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("TO")]),s._v(" xstrm"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("GRANT")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("SELECT")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("ANY")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("TABLE")]),s._v(" to xstrm"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("GRANT")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("LOCK")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("ANY")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("TABLE")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("TO")]),s._v(" xstrm"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\ngrant select_catalog_role to xstrm"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])]),a("ul",[a("li",[a("p",[a("strong",[s._v("xstream_tbs")])]),s._v(" "),a("p",[s._v("为八爪鱼订阅连接用户的表空间名，请根据实际规划设置。")])]),s._v(" "),a("li",[a("p",[a("strong",[s._v("/opt/oracle/oradata/orcl/xstream_tbs.dbf")])]),s._v(" "),a("p",[s._v("为八爪鱼订阅连接用户的表空间文件，请根据实际规划设置。")])]),s._v(" "),a("li",[a("p",[a("strong",[s._v("xstrm")])]),s._v(" "),a("p",[s._v("为八爪鱼订阅连接用户名，请根据实际规划设置。")])]),s._v(" "),a("li",[a("p",[a("strong",[s._v("password")])]),s._v(" "),a("p",[s._v("为八爪鱼订阅连接用户密码，请根据实际规划设置。")])])]),s._v(" "),a("h4",{attrs:{id:"_2-4-执行以下命令修改日志记录参数。"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-4-执行以下命令修改日志记录参数。"}},[s._v("#")]),s._v(" 2.4 执行以下命令修改日志记录参数。")]),s._v(" "),a("div",{staticClass:"language-javascript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[s._v("alter database add supplemental log "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("data")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("all"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" columns"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])]),a("h4",{attrs:{id:"_2-5-执行以下命令退出数据库连接。"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-5-执行以下命令退出数据库连接。"}},[s._v("#")]),s._v(" 2.5 执行以下命令退出数据库连接。")]),s._v(" "),a("div",{staticClass:"language-javascript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[s._v("exit"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])]),a("h3",{attrs:{id:"_3-创建xstream出站服务器。"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-创建xstream出站服务器。"}},[s._v("#")]),s._v(" 3 创建XStream出站服务器。")]),s._v(" "),a("p",[s._v("**注意：**"),a("strong",[s._v("一个XStream出站服务器只能在一个边缘集群中使用，若该数据库需要用于多个边缘集群，需创建多个XStream出站服务器。")])]),s._v(" "),a("h4",{attrs:{id:"_3-1-在命令行工具中执行以下命令以xstrmadmin用户连接到数据库实例。"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-在命令行工具中执行以下命令以xstrmadmin用户连接到数据库实例。"}},[s._v("#")]),s._v(" 3.1 在命令行工具中执行以下命令以xstrmadmin用户连接到数据库实例。")]),s._v(" "),a("div",{staticClass:"language-javascript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[s._v("sqlplus xstrmadmin"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("password@host"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("port"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("SID")]),s._v("\n")])])]),a("ul",[a("li",[a("p",[a("strong",[s._v("xstrmadmin")])]),s._v(" "),a("p",[s._v("为XStream管理员用户名，在2.2中创建。")])]),s._v(" "),a("li",[a("p",[a("strong",[s._v("password")])]),s._v(" "),a("p",[s._v("为XStream管理员用户密码，在2.2中设置。")])]),s._v(" "),a("li",[a("p",[a("strong",[s._v("host")])]),s._v(" "),a("p",[s._v("为数据库实例所在服务器的IP地址，请根据实际情况设置。")])]),s._v(" "),a("li",[a("p",[a("strong",[s._v("port")])]),s._v(" "),a("p",[s._v("为数据库实例所使用的端口，请根据实际情况设置。")])]),s._v(" "),a("li",[a("p",[a("strong",[s._v("SID")])]),s._v(" "),a("p",[s._v("为要同步数据所在实例的实例名，请根据实际情况设置。")])])]),s._v(" "),a("h4",{attrs:{id:"_3-2-执行以下命令创建xstream出站服务器。"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-执行以下命令创建xstream出站服务器。"}},[s._v("#")]),s._v(" 3.2 执行以下命令创建XStream出站服务器。")]),s._v(" "),a("div",{staticClass:"language-javascript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("DECLARE")]),s._v("\n  tables "),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("DBMS_UTILITY")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("UNCL_ARRAY")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  schemas "),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("DBMS_UTILITY")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("UNCL_ARRAY")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("BEGIN")]),s._v("\n   "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("tables")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'dbusr.tablename'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n   "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("tables")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("NULL")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n   "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("schemas")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'dbschemas'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n   "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("schemas")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("NULL")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n   "),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("DBMS_XSTREAM_ADM")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("CREATE_OUTBOUND")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token parameter"}},[s._v("server_name")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=>")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'dbzxout'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token parameter"}},[s._v("table_names")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=>")]),s._v(" tables"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token parameter"}},[s._v("schema_names")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=>")]),s._v(" schemas\n   "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("END")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])]),a("ul",[a("li",[a("p",[a("strong",[s._v("dbusr.tablename")])]),s._v(" "),a("p",[s._v("为要同步的数据表名，可以先只填一个。")])]),s._v(" "),a("li",[a("p",[a("strong",[s._v("dbschemas")])]),s._v(" "),a("p",[s._v("为要同步数据表所在的schemas，即CDC需要抓取哪个schemas下的数据，请根据实际情况设置。一个用户一般相应一个schema，该用户的schema名等于username，并作为该用户缺省schema。如果不限制可以设置schemas(1) := NULL;")])]),s._v(" "),a("li",[a("p",[a("strong",[s._v("dbzxout")])]),s._v(" "),a("p",[s._v("为出站服务器名称，需保证唯一，请根据实际规划设置。")])])]),s._v(" "),a("h4",{attrs:{id:"_3-3-执行以下命令退出数据库连接。"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-3-执行以下命令退出数据库连接。"}},[s._v("#")]),s._v(" 3.3 执行以下命令退出数据库连接。")]),s._v(" "),a("div",{staticClass:"language-javascript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[s._v("exit"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])]),a("h4",{attrs:{id:"_3-4-执行以下命令以sys用户连接到数据库实例。"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-4-执行以下命令以sys用户连接到数据库实例。"}},[s._v("#")]),s._v(" 3.4 执行以下命令以sys用户连接到数据库实例。")]),s._v(" "),a("div",{staticClass:"language-javascript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[s._v("sqlplus sys"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("password@host"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("port"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("SID")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("as")]),s._v(" sysdba\n")])])]),a("ul",[a("li",[a("p",[a("strong",[s._v("password")])]),s._v(" "),a("p",[s._v("为数据库sys用户的密码，请向数据库管理员获取。")])]),s._v(" "),a("li",[a("p",[a("strong",[s._v("host")])]),s._v(" "),a("p",[s._v("为数据库实例所在服务器的IP地址，请根据实际情况设置。")])]),s._v(" "),a("li",[a("p",[a("strong",[s._v("port")])]),s._v(" "),a("p",[s._v("为数据库实例所使用的端口，请根据实际情况设置。")])]),s._v(" "),a("li",[a("p",[a("strong",[s._v("SID")])]),s._v(" "),a("p",[s._v("为要同步数据所在实例的实例名，请根据实际情况设置。")])])]),s._v(" "),a("h4",{attrs:{id:"_3-5-执行以下命令允许xstrm用户连接xstream出站服务器。"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-5-执行以下命令允许xstrm用户连接xstream出站服务器。"}},[s._v("#")]),s._v(" 3.5 执行以下命令允许xstrm用户连接XStream出站服务器。")]),s._v(" "),a("div",{staticClass:"language-javascript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("BEGIN")]),s._v("\n   "),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("DBMS_XSTREAM_ADM")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("ALTER_OUTBOUND")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token parameter"}},[s._v("server_name")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=>")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'dbzxout'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token parameter"}},[s._v("connect_user")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=>")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'xstrm'")]),s._v("\n   "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("END")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])]),a("ul",[a("li",[a("p",[a("strong",[s._v("dbzxout")])]),s._v(" "),a("p",[s._v("为出站服务器名称，在3.2中设置。")])]),s._v(" "),a("li",[a("p",[a("strong",[s._v("xstrm")])]),s._v(" "),a("p",[s._v("为八爪鱼连接用户名，在2.3中设置。")])])]),s._v(" "),a("h4",{attrs:{id:"_3-6-执行以下命令退出数据库连接。"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-6-执行以下命令退出数据库连接。"}},[s._v("#")]),s._v(" 3.6 执行以下命令退出数据库连接。")]),s._v(" "),a("div",{staticClass:"language-javascript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[s._v("exit"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])]),a("h2",{attrs:{id:"二、配置oracle数据源"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#二、配置oracle数据源"}},[s._v("#")]),s._v(" 二、配置Oracle数据源")]),s._v(" "),a("p",[a("img",{attrs:{src:"http://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/zh-CN/7118359951/p135696.png",alt:"image.png",title:"image.png"}})]),s._v(" "),a("ul",[a("li",[a("p",[a("strong",[s._v("xstream_adm_username、")])]),s._v(" "),a("p",[a("strong",[s._v("xstream_adm_password")])]),s._v(" "),a("p",[s._v("对应2.2创建的用户名和密码")])]),s._v(" "),a("li",[a("p",[a("strong",[s._v("xstream_username、xstream_password")])]),s._v(" "),a("p",[s._v("对应2.3创建的用户名和密码")])]),s._v(" "),a("li",[a("p",[a("strong",[s._v("xstream_server_name")])]),s._v(" "),a("p",[s._v("对应3.2创建的"),a("strong",[s._v("dbzxout")])])])]),s._v(" "),a("h2",{attrs:{id:"三、日志清理"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#三、日志清理"}},[s._v("#")]),s._v(" 三、日志清理")]),s._v(" "),a("p",[s._v("1. 背景")]),s._v(" "),a("p",[s._v("数据库开启归档日志，若不及时清理归档日志，系统就会报")]),s._v(" "),a("p",[a("strong",[s._v("ORA-00257: archiver error. Connect internal only, until freed")])]),s._v(" "),a("p",[s._v("实现自动清理归档日志，可以通过 Linux crontab,Oracle rman。")]),s._v(" "),a("p",[s._v("2. 创建日志清理脚本")]),s._v(" "),a("p",[s._v("2.1 新建一个脚本clearLog.sh")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${ORACLE_HOME}")]),s._v("/bin/rman nocatalog "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("log")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/home/oracle/del_arch"),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("date")]),s._v(" +%Y-%m-%d"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v(".log  \n    connect target /\n    crosscheck archivelog all"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    delete noprompt expired archivelog all"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    DELETE noprompt force ARCHIVELOG ALL COMPLETED BEFORE "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'SYSDATE-11'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exit")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nEOF\n")])])]),a("p",[s._v("2.2 手动测试脚本")]),s._v(" "),a("p",[s._v("赋权：chomd +x clearLog.sh")]),s._v(" "),a("p",[s._v("执行：./clearLog.sh")]),s._v(" "),a("p",[s._v("查看del_arch.log文件，能删除归档。")]),s._v(" "),a("p",[a("img",{attrs:{src:"http://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/zh-CN/7543230061/p167189.png",alt:"lok"}})]),s._v(" "),a("p",[s._v("3 设置自动清理")]),s._v(" "),a("p",[s._v("在oracle用户下执行")]),s._v(" "),a("p",[s._v("crontab -e")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token number"}},[s._v("30")]),s._v(" 02 * * * /home/oracle/clearLOG.sh\n")])])]),a("p",[s._v("凌晨2:30分执行clearLog.sh")]),s._v(" "),a("p",[s._v("cron服务是Linux的内置服务，但它不会开机自动启动。可以用以下命令启动和停止服务：")]),s._v(" "),a("p",[a("code",[s._v("/sbin/service")]),s._v(" "),a("code",[s._v("crond start")])]),s._v(" "),a("p",[a("code",[s._v("/sbin/service")]),s._v(" "),a("code",[s._v("crond stop")])]),s._v(" "),a("p",[a("code",[s._v("/sbin/service")]),s._v(" "),a("code",[s._v("crond restart")])]),s._v(" "),a("p",[a("code",[s._v("/sbin/service")]),s._v(" "),a("code",[s._v("crond reload")])])])}),[],!1,null,null,null);t.default=r.exports}}]);