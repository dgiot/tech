(window.webpackJsonp=window.webpackJsonp||[]).push([[259],{823:function(t,s,a){"use strict";a.r(s);var e=a(10),r=Object(e.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"parseserver配置指南"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#parseserver配置指南"}},[t._v("#")]),t._v(" ParseServer配置指南")]),t._v(" "),a("blockquote",[a("p",[t._v("番外部分不属于原版指南的一部分，由译者译制添加，以提供完整的体验。")]),t._v(" "),a("p",[t._v("ParseServer GitHub地址："),a("a",{attrs:{href:"https://github.com/parse-community/Parse-Server",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://github.com/parse-community/Parse-Server"),a("OutboundLink")],1)])]),t._v(" "),a("p",[t._v("“开始”“一章有讲到，在本书GitHub有提供一个ParseServer脚手架项目，就是基于ParseServer + Express编写的，在本章会介绍更多关于ParseServer的配置，以满足开发者更多的需求。")]),t._v(" "),a("p",[t._v("比如，在“用户”一章有讲到，通过邮箱注册用户后，系统会自动发送一封邮件到指定邮箱，然后用户通过邮箱中的链接激活账号，但这是在使用Parse服务商的服务时才会自动发送邮件，自己搭建服务的话，这封邮件谁来发送呢？")]),t._v(" "),a("p",[t._v("这就要开发者自己来配置了。")]),t._v(" "),a("h3",{attrs:{id:"parse-server-express"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#parse-server-express"}},[t._v("#")]),t._v(" Parse Server + Express")]),t._v(" "),a("p",[t._v("你可以创建一个Parse实例后，挂载到Express站点上，就像刚才本书提供的ParseServer脚手架里面做的一样：")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" express "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'express'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" ParseServer "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'parse-server'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ParseServer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" app "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("express")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" api "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ParseServer")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  databaseURI"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'mongodb://localhost:27017/dev'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 你的Mongo数据库地址")]),t._v("\n  cloud"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'/home/myApp/cloud/main.js'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("           "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 云代码文件的路径，绝对路径")]),t._v("\n  appId"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'myAppId'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("                             "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// appId  ")]),t._v("\n  masterKey"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'myMasterKey'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("                     "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// masterKey")]),t._v("\n  fileKey"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'optionalFileKey'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("                   "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// fileKey")]),t._v("\n  serverURL"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'http://localhost:1337/parse'")]),t._v("      "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 设置Parse服务地址")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 在/parse URL 前缀上提供Parse服务")]),t._v("\napp"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("use")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'/parse'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" api"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\napp"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("listen")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1337")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'parse-server-example running on port 1337.'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("p",[t._v("要查看所有可用的ParseServer 参数选项，可以运行"),a("code",[t._v("parse-server --help")]),t._v("查看。")]),t._v(" "),a("h2",{attrs:{id:"配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#配置"}},[t._v("#")]),t._v(" 配置")]),t._v(" "),a("p",[t._v("ParseServer可以通过下面的选项来配置，你可以在创建ParseServer实例的时候传入它们，也可以配置在JSON文件中用命令行加载"),a("code",[t._v("parse-server path/to/configuration.json")]),t._v("。")]),t._v(" "),a("h3",{attrs:{id:"基本选项"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#基本选项"}},[t._v("#")]),t._v(" 基本选项")]),t._v(" "),a("ul",[a("li",[a("code",[t._v("appId")]),t._v("**(必需) **- 应用id。")]),t._v(" "),a("li",[a("code",[t._v("masterKey")]),t._v("**(必需) **- 用来无视所有ACL/CLP权限，你应该妥善保管它。")]),t._v(" "),a("li",[a("code",[t._v("databaseURI")]),t._v("**(必需) **- 你的数据库地址, i.e."),a("code",[t._v("mongodb://user:pass@host.com/dbname")]),t._v("。如果你的密码有特殊字符，确保它 "),a("a",{attrs:{href:"https://www.gitbook.com/book/jaweii/parse/edit#",target:"_blank",rel:"noopener noreferrer"}},[t._v("URL encode 编码。"),a("OutboundLink")],1)]),t._v(" "),a("li",[a("code",[t._v("port")]),t._v("- 端口，默认1337。")]),t._v(" "),a("li",[a("code",[t._v("serverURL")]),t._v("- ParseServer的URL，当云代码发送请求到ParseServer时会发送这个地址。")]),t._v(" "),a("li",[a("code",[t._v("cloud")]),t._v("- 云代码文件的路径地址，是绝对路径。")]),t._v(" "),a("li",[a("code",[t._v("push")]),t._v("- 配置APNS和GCM推送.参考"),a("a",{attrs:{href:"http://docs.parseplatform.org/parse-server/guide/#push-notifications_push-notifications-quick-start",target:"_blank",rel:"noopener noreferrer"}},[t._v("Push Notifications quick start"),a("OutboundLink")],1),t._v("。")])]),t._v(" "),a("h3",{attrs:{id:"客户端秘钥选项"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#客户端秘钥选项"}},[t._v("#")]),t._v(" 客户端秘钥选项")]),t._v(" "),a("p",[t._v("下面密钥不是必需选项，如果设置了对应的选项，在对应的SDK初始化中需要传入你设置的秘钥。")]),t._v(" "),a("ul",[a("li",[a("code",[t._v("clientKey")])]),t._v(" "),a("li",[a("code",[t._v("javascriptKey")])]),t._v(" "),a("li",[a("code",[t._v("restAPIKey")])]),t._v(" "),a("li",[a("code",[t._v("dotNetKey")])])]),t._v(" "),a("h3",{attrs:{id:"高级选项"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#高级选项"}},[t._v("#")]),t._v(" 高级选项")]),t._v(" "),a("ul",[a("li",[a("code",[t._v("allowClientClassCreation")]),t._v("- 设置为false后禁止客户端创建Class表，默认为true。")]),t._v(" "),a("li",[a("code",[t._v("enableAnonymousUsers")]),t._v("- 设置为false后禁用用户匿名功能，默认为true。")]),t._v(" "),a("li",[a("code",[t._v("auth")]),t._v("- 用来配置支持"),a("a",{attrs:{href:"http://docs.parseplatform.org/parse-server/guide/#oauth-and-3rd-party-authentication",target:"_blank",rel:"noopener noreferrer"}},[t._v("3rd party authentication"),a("OutboundLink")],1),t._v("。")]),t._v(" "),a("li",[a("code",[t._v("facebookAppIds")]),t._v("- Facebook应用Id数组。")]),t._v(" "),a("li",[a("code",[t._v("mountPath")]),t._v("- 指定服务挂载的路由. 默认为"),a("code",[t._v("/parse")])]),t._v(" "),a("li",[a("code",[t._v("filesAdapter")]),t._v("- 默认的文件管理可以通过适配器修改，参考"),a("a",{attrs:{href:"https://www.gitbook.com/book/jaweii/parse/edit#",target:"_blank",rel:"noopener noreferrer"}},[a("code",[t._v("FilesAdapter.js")]),a("OutboundLink")],1),t._v("。")]),t._v(" "),a("li",[a("code",[t._v("maxUploadSize")]),t._v("- 最大上传文件限制，默认20M。")]),t._v(" "),a("li",[a("code",[t._v("loggerAdapter")]),t._v("- 参考"),a("a",{attrs:{href:"https://www.gitbook.com/book/jaweii/parse/edit#",target:"_blank",rel:"noopener noreferrer"}},[a("code",[t._v("LoggerAdapter.js")]),a("OutboundLink")],1),t._v("。")]),t._v(" "),a("li",[a("code",[t._v("logLevel")]),t._v("- 设置你想要的日志记录级别，默认为"),a("code",[t._v("info")]),t._v("，查看"),a("a",{attrs:{href:"https://github.com/winstonjs/winston#logging-levels",target:"_blank",rel:"noopener noreferrer"}},[t._v("Winston logging levels"),a("OutboundLink")],1),t._v(" 支持哪些值。")]),t._v(" "),a("li",[a("code",[t._v("sessionLength")]),t._v("- 设置session有效期，单位秒，默认31536000 seconds (1 年)。")]),t._v(" "),a("li",[a("code",[t._v("maxLimit")]),t._v("- 限制查询的最大返回数量，默认不限制。")]),t._v(" "),a("li",[a("code",[t._v("revokeSessionOnPasswordReset")]),t._v("- 当用户密码被重置，作废之前的session。")]),t._v(" "),a("li",[a("code",[t._v("accountLockout")]),t._v("- 当用户尝试修改其他用户的信息时，锁定用户账号。")]),t._v(" "),a("li",[a("code",[t._v("passwordPolicy")]),t._v("- 密码策略。")]),t._v(" "),a("li",[a("code",[t._v("customPages")]),t._v("- 与邮箱验证链接、密码重置链接、面向用户的页面地址哈希，可用值有："),a("code",[t._v("parseFrameURL")]),t._v(","),a("code",[t._v("invalidLink")]),t._v(","),a("code",[t._v("choosePassword")]),t._v(","),a("code",[t._v("passwordResetSucces")]),t._v(","),a("code",[t._v("verifyEmailSuccess")]),t._v(".")]),t._v(" "),a("li",[a("code",[t._v("middleware")]),t._v("- (CLI only), 一个模块名，功能是express的中间件。 这个选项用来注入一个监听的中间件.")]),t._v(" "),a("li",[a("code",[t._v("masterKeyIps")]),t._v("- 一个IP数组，masterKey的使用将被限定在这个数组范围内，默认为空，不限制。如果使用了这个选项，确保使用云代码时，你的IP包含在内。")]),t._v(" "),a("li",[a("code",[t._v("readOnlyMasterKey")]),t._v("- 类似于masterKey，但是只有读权限，没有写权限。")])]),t._v(" "),a("h2",{attrs:{id:"邮箱验证和密码重置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#邮箱验证和密码重置"}},[t._v("#")]),t._v(" 邮箱验证和密码重置")]),t._v(" "),a("p",[t._v("使用email适配器，可以验证用户的邮箱地址和允许密码重置。下面以maigun为例，Mailgun适配器提供了发送邮件的功能，要使用这个，你需要注册Mailgun，并添加下面代码到你的项目：")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" server "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("ParseServer")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("...")]),t._v("otherOptions"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 启用邮箱验证")]),t._v("\n  verifyUserEmails"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 如果 `verifyUserEmails` 为 `true` 并且")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//     如果 `emailVerifyTokenValidityDuration` 为 `undefined` 那么")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//        email verify token 永不过期")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//     否则")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//        email verify token 在`emailVerifyTokenValidityDuration`之后过期")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// `emailVerifyTokenValidityDuration` 默认为 `undefined`")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 2小时候过期 (= 2 * 60 * 60 == 7200 seconds)")]),t._v("\n  emailVerifyTokenValidityDuration"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("60")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("60")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//单位秒 (2 hours = 7200 seconds)")]),t._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 设置为false，允许用户未验证也能登录")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 设置为true，则必须验证才能登录")]),t._v("\n  preventLoginWithUnverifiedEmail"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 默认 false")]),t._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 你的应用的URL")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 将会出现在验证邮箱和密码重置的链接中")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 就像设置serverURL一样")]),t._v("\n  publicServerURL"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'https://example.com/parse'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 你的应用名，将作为邮件主题")]),t._v("\n  appName"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Parse App'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// email适配器")]),t._v("\n  emailAdapter"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    module"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'@parse/simple-mailgun-adapter'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    options"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 设置发件地址")]),t._v("\n      fromAddress"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'parse@example.com'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 你的mailgun域名")]),t._v("\n      domain"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'example.com'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 你的mailgun apiKey")]),t._v("\n      apiKey"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'key-mykey'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 账户停用策略 (可选) - 默认为undefined")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/*\n  如果设置了帐户锁定策略，并且登录尝试次数超过了“阈值”次数，\n  则“login”api调用将返回错误代码“Parse.Error.OBJECT_NOT_FOUND”，\n  并显示错误消息“您的帐户由于多次登录失败而被锁定尝试。 请在<时间>分钟后再试一次。 \n  在没有登录尝试的“持续时间”分钟之后，应用程序将允许用户再次尝试登录。\n  */")]),t._v("\n  accountLockout"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    duration"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("5")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 账户锁定等待时长，等位分钟，设置为1-100000.")]),t._v("\n    threshold"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 设置登录错误次数阈值，1-1000")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 可选的密码策略")]),t._v("\n  passwordPolicy"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//两个可选设置来执行强密码。 可以指定一个或两个。")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//如果两者都被指定，则两个检查都必须通过才能接受密码")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 1.表示要执行的模式的RegExp对象或正则表达式字符串")]),t._v("\n    validatorPattern"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token regex"}},[a("span",{pre:!0,attrs:{class:"token regex-delimiter"}},[t._v("/")]),a("span",{pre:!0,attrs:{class:"token regex-source language-regex"}},[t._v("^(?=.*[a-z])(?=.*[A-Z])(?=.*[0-9])(?=.{8,})")]),a("span",{pre:!0,attrs:{class:"token regex-delimiter"}},[t._v("/")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 最少8为，大小写和数字组成")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 2. 在回调中使用验证方法验证")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("validatorCallback")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("password")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("validatePassword")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("password"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" \n    doNotAllowUsername"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 是否允许账号密码相同")]),t._v("\n    maxPasswordAge"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("90")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 设置密码过期天数")]),t._v("\n    maxPasswordHistory"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("5")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 禁用前n个密码再次使用")]),t._v("\n     "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//设置密码重置链接超时时间")]),t._v("\n    resetTokenValidityDuration"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("24")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("60")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("60")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//24小时")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("p",[t._v("你还可以安装来自社区的其他邮件适配器：")]),t._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"https://www.npmjs.com/package/parse-server-postmark-adapter",target:"_blank",rel:"noopener noreferrer"}},[t._v("parse-server-postmark-adapter"),a("OutboundLink")],1)]),t._v(" "),a("li",[a("a",{attrs:{href:"https://www.npmjs.com/package/parse-server-sendgrid-adapter",target:"_blank",rel:"noopener noreferrer"}},[t._v("parse-server-sendgrid-adapter"),a("OutboundLink")],1)]),t._v(" "),a("li",[a("a",{attrs:{href:"https://www.npmjs.com/package/parse-server-mandrill-adapter",target:"_blank",rel:"noopener noreferrer"}},[t._v("parse-server-mandrill-adapter"),a("OutboundLink")],1)]),t._v(" "),a("li",[a("a",{attrs:{href:"https://www.npmjs.com/package/parse-server-simple-ses-adapter",target:"_blank",rel:"noopener noreferrer"}},[t._v("parse-server-simple-ses-adapter"),a("OutboundLink")],1)]),t._v(" "),a("li",[a("a",{attrs:{href:"https://www.npmjs.com/package/parse-server-mailgun-adapter-template",target:"_blank",rel:"noopener noreferrer"}},[t._v("parse-server-mailgun-adapter-template"),a("OutboundLink")],1)]),t._v(" "),a("li",[a("a",{attrs:{href:"https://www.npmjs.com/package/parse-server-sendinblue-adapter",target:"_blank",rel:"noopener noreferrer"}},[t._v("parse-server-sendinblue-adapter"),a("OutboundLink")],1)]),t._v(" "),a("li",[a("a",{attrs:{href:"https://www.npmjs.com/package/parse-server-mailjet-adapter",target:"_blank",rel:"noopener noreferrer"}},[t._v("parse-server-mailjet-adapter"),a("OutboundLink")],1)]),t._v(" "),a("li",[a("a",{attrs:{href:"https://www.npmjs.com/package/simple-parse-smtp-adapter",target:"_blank",rel:"noopener noreferrer"}},[t._v("simple-parse-smtp-adapter"),a("OutboundLink")],1)]),t._v(" "),a("li",[a("a",{attrs:{href:"https://www.npmjs.com/package/parse-server-generic-email-adapter",target:"_blank",rel:"noopener noreferrer"}},[t._v("parse-server-generic-email-adapter"),a("OutboundLink")],1)])]),t._v(" "),a("p",[t._v("在本书提供的ParseServer脚手架中已经配置好了邮件服务，使用的是译者专门编写的适配器parse-zh-email-adapter，你只需要换上你的SMTP账号就行了。")]),t._v(" "),a("p",[t._v("但是还有些地方要你自己修改，比如邮箱验证成功的页面：")]),t._v(" "),a("p",[a("img",{attrs:{src:"/assets/email.png",alt:""}})]),t._v(" "),a("p",[t._v("英文界面，对用户显然不够友好，如果要修改成理想的界面，编辑目录"),a("code",[t._v("./node_modules/parse-server/public_html/")]),t._v("下的模板即可。")]),t._v(" "),a("h2",{attrs:{id:"日志"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#日志"}},[t._v("#")]),t._v(" 日志")]),t._v(" "),a("p",[t._v("ParseServer日志默认会：")]),t._v(" "),a("ul",[a("li",[t._v("在控制台打印。")]),t._v(" "),a("li",[t._v("将每天的日志保存到新文件中。")])]),t._v(" "),a("p",[t._v("日志在Parse仪表盘中也可以查看。")]),t._v(" "),a("h3",{attrs:{id:"记录每个请求"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#记录每个请求"}},[t._v("#")]),t._v(" 记录每个请求")]),t._v(" "),a("p",[t._v("在运ParseServer服务时，将环境变量"),a("code",[t._v("VERBOSE")]),t._v("设置为'1'即可。比如：")]),t._v(" "),a("p",[a("code",[t._v("VERBOSE='1' parse-server --appId APPLICATION_ID --masterKey MASTER_KEY")])]),t._v(" "),a("h3",{attrs:{id:"设置日志目录"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#设置日志目录"}},[t._v("#")]),t._v(" 设置日志目录")]),t._v(" "),a("p",[t._v("将环境变量"),a("code",[t._v("PARSE_SERVER_LOGS_FOLDER")]),t._v("设置为新的路径即可：")]),t._v(" "),a("p",[a("code",[t._v("PARSE_SERVER_LOGS_FOLDER='<path-to-logs-folder>' parse-server --appId APPLICATION_ID --masterKey MASTER_KEY")])]),t._v(" "),a("h3",{attrs:{id:"设置日志级别"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#设置日志级别"}},[t._v("#")]),t._v(" 设置日志级别")]),t._v(" "),a("p",[t._v("通过环境变量"),a("code",[t._v("logLevel")]),t._v("设置：")]),t._v(" "),a("p",[a("code",[t._v("parse-server --appId APPLICATION_ID --masterKey MASTER_KEY --logLevel LOG_LEVEL")])])])}),[],!1,null,null,null);s.default=r.exports}}]);