
# 操作步骤
 
 1. 获取软件
 
 [点击下载](http://dgiot-1253666439.cos.ap-shanghai-fsi.myqcloud.com/blog/meter/meter_v2.7.1.zip),解压到D盘根目录,目录结构如下D:\meter_v2.7.1
 
 2. 注册OCX
  + win7
  用管理员启动cmd窗口
  ```
   cd D:\meter_v2.7.1\ocx
   cd D:\meter_v2.7.1\ocx
   copy Mscomm.srg  C:\Windows\System\
   copy Mscomm32.dep  C:\Windows\System\
   copy Mscomm32.ocx  C:\Windows\System\
   Regsvr32  C:\Windows\System\\MSCOMM32.OCX
  ```  
  + win10
  ```
     cd D:\meter_v2.7.1\ocx
     copy Mscomm.srg  C:\Windows\SysWOW64\
     copy Mscomm32.dep  C:\Windows\SysWOW64\
     copy Mscomm32.ocx  C:\Windows\SysWOW64\
     Regsvr32  C:\Windows\System\MSCOMM32.OCX
  ``` 
   提示DllRegisterServer 在MSCOMM32.OCX 已成功
   
  3、启动软件
  
  选中 D:\meter_v2.7.1\645MeterV2.7.1.exe 软件，右击鼠标，选择以管理员启动软件界面
 
  ![meter_demo.png](http://dgiot-1253666439.cos.ap-shanghai-fsi.myqcloud.com/blog/meter/meter_demo.png)

  4、打开串口
    选择上一步创建的成对串口 com1,波特率:115200,校验位：无，数据位：8 停止位:1
  
# 产品说明

虚拟表V2.5.2是根据DL/T645-1997规约、DL/T645-2007规约、上海规约和BNC智能终端规约设计的虚拟电表软件。

本软件主要的操作说明如下：

1. 下拉菜单的电表参数包括：

+ 功能类：中继测试，侦听测试，白名单测试，黑名单测试，区间表单测试，不识别表号

  1. 中继测试只针对TCT监控模块虚拟表模式；
 
  2. 侦听测试可针对监控645的TCT模块，监控载波的TCT模块或者监控串口数据的交互，对接收的数据进行解析（如果是监控载波鼎信报文，选择单/三相显示，可完成侦听记录/侦听报文的显示在“按相位分屏”和“不分屏”之间切换）；

  3. 白名单为选中的表号有效；
 
  4. 黑名单为选中的表号无效；
 
  5. 区间表单为接收到所填黑名单区间内的表号无效；
 
  6. 不识别表号为对任意表号命令均有效。
 
+ 命令类：设置底度----设置电量的底度。

+ 使能类：前导符FE，编程开关，支持跨相，通道芯片，长帧测试，自设回复，循环回复。

  1. 前导符FE----选中响应帧有4个0xFE作为前导符；
 
  2. 编程开关----选中才能写设备地址地址有效；
 
  3. 支持跨相----只有中继测试时有效，选中则不进行相位比较，返回的相位信息为自身所处相位（目前表所处相位是根据表号决定，表号除以3，余数为0，相位为C相；相余数为1，相位为A相；余数为2，相位为B相）；
 
  4. 通道芯片----中继测试时无效，不选中时响应的报文带1字节的相位信息；
 
  5. 长帧测试----自定义长帧测试的数据标识。

   设置长帧命令表示当接到这条命令，将数据标识后的数据内容存储起来，最大255个字节，响应报文的数据域只有数据标识；
 
   读取长帧命令表示当接到这条命令，按数据标识后设置的长度（1字节，小于之前发送的存储数据长度）回复之前存储的数据内容。
 
  6. 自设回复----自定义响应报文的内容
  
   选中自设回复后，任何命令都将按自定义的报文进行响应。
   
   控制码：1个字节
   
   数据域：使用者自定义数据域内容，可自由选择是否加0x33或数据域翻转处理，最大255个字节。
   
   后续字节：使用者自定义在645响应帧后添加的内容。

  7. 循环回复----按规律循环回复特定报文，使用者可自定义起始字节数和终止字节数，范围为0~255。
  
  **注意：** 自设回复和循环回复使能二选一，不能同时有效。
   表类型：新载波表，采集器，开箱监视器，旧载波表
   
2. 事件上报功能 

**注意：** 使用者自行定义四个输入框内容

  + 命令框：读事件上报的命令
  
  + 响应框：上报的事件
  
  + 取消框：取消事件上报状态的命令
  
  + 结束框：回复事件上报状态已取消
  
  + I/O配置：选择为硬件设置，只需点击“事件使能”就置上事件上报状态；不选择为软件设置，点击“事件使能”后接受到特定报文才置上事件上报状态。

3. 快捷键 

ALT+S：在1200 / 2400 / 4800 / 9600bps之间快速切换串口波特率。
ALT+A：快速切换是否循环回复。

4. 可变速率
选中时此表为可变速率表，支持从1200，2400，4800，9600自动向上变速，变速条件为正确应答使用者规定的次数。

5. 命令选择

使用者可自定义哪些命令响应，哪些命令不响应，其中选中的命令会响应。

**注意**：现在只针对DL/T645-1997的两条读表号命令。

6. 提示说明

在软件开启时，在操作记录中将对主要的几个菜单选项进行提示，帮助使用者更好地确定软件应用时的条件。

7. 645显示

只处理DL/T645协议报文。

8.延时选择

只在645显示被选择时使能。

  1. 响应延迟
  
  收到命令帧后响应延迟，范围为0-5000ms。
  
  2. 字节延迟
  
   字节之间停顿时间, 范围为0-5000ms。
   
  3. 首字节后延迟

  首字节响应后停顿时间, 范围为0-500ms。
  
  只在首字节响应后，虚拟表会延迟延时响应后续字节。

  如果选择随机，虚拟表将在0至所选时间内随机一个时间后对命令进行各种延迟。

9.  鼎信显示
 
 只在侦听测试模式下显示鼎信协议报文，解析报文。

10. 鼎信不解析

只在侦听测试模式下显示鼎信协议报文，不解析报文。

11. 自定义数据

按测试要求填写一些645数据项内容。

12. 组命令帧

弹出命令发送组帧窗口，这是模拟通道芯片下的设备作为主动发起方，命令帧格式必须符合645规约格式。

需要通信的表号会列于列表中，使用者可以直接用txt文档导入表号，或者一个个输入编辑，双击表号改变表号的选择状态，或者使用右键全部选择/全部取消。

控制码：1个字节

数据域内容：
  1. 645数据标识
  
   97为2个字节，07为4个字节，填写的内容无需加0x33和翻转处理。
   
  2. 645数据帧格式
  
  完整的645帧，需要表号，控制码和数据内容三个部分。
  
   3. 自定义数据格式
   
   数据域内容由使用者自定义。

注：如果提示类没有注册，请安装微软运行库即可
