(window.webpackJsonp=window.webpackJsonp||[]).push([[36],{545:function(e,a,s){"use strict";s.r(a);var t=s(7),r=Object(t.a)({},(function(){var e=this,a=e.$createElement,s=e._self._c||a;return s("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[s("h1",{attrs:{id:"数据同步"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#数据同步"}},[e._v("#")]),e._v(" 数据同步")]),e._v(" "),s("h2",{attrs:{id:"api-hook配置同步-数据库-缓存"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#api-hook配置同步-数据库-缓存"}},[e._v("#")]),e._v(" API Hook配置同步（数据库->缓存）")]),e._v(" "),s("p",[e._v("用户调用API修改parse库配置后，通API Hook同步到ets缓存，例如通道中做如下处理")]),e._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v('%% 初始化池子\nhandle_init(State) ->\n    shuwa_parse:subscribe(<<"Device">>, post),\n    shuwa_parse:subscribe(<<"Device/*">>, post),\n    {ok, State}.\n\nhandle_message({sync_parse, Args}, State) ->\n    %% do something \n    lager:info("sync_parse ~p", [Args]),\n    {ok, State};\n')])])]),s("h2",{attrs:{id:"livequery同步-数据库-缓存"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#livequery同步-数据库-缓存"}},[e._v("#")]),e._v(" Livequery同步（数据库->缓存）")]),e._v(" "),s("p",[e._v("parse库修改同步到ets缓存 "),s("br"),e._v("\t\nparse开启livequery"),s("br"),e._v("\t\n编辑\nvim /data/shuwa_parse_server/script/config.json "),s("br"),e._v("\t\n修改 "),s("strong",[e._v("app")]),e._v(" 下 "),s("strong",[e._v("liveQuery")]),e._v(" 添加需要同步的表 "),s("br"),e._v(" "),s("img",{attrs:{src:"http://dgiot-1253666439.cos.ap-shanghai-fsi.myqcloud.com/shuwa_tech/zh/blog/study/parse/livequery_config.png",alt:""}})]),e._v(" "),s("p",[e._v("登录获取SessionToken")]),e._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v('shuwa_parse_handler:login_by_account(UserName, Password).\n{ok,#{<<"sessionToken">> => <<"r:af99fafcfebbcfe04770e74ca2646b11">>}}\n')])])]),s("p",[e._v("shuwa_livequery订阅Device表")]),e._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v(' shuwa_livequery:subscribe(<<"r:af99fafcfebbcfe04770e74ca2646b11">>, <<"Device">>, #{}),\n')])])]),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v('handle_info({livequery, #{<<"object">> := Object}}, #task{step = login} = State) ->\n    {noreply, do_depploy(Object, State)};\n\nhandle_info({livequery, _Other}, State) ->\n    {noreply, State};\n')])])]),s("h2",{attrs:{id:"api-hook数据同步-数据库-缓存-用户"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#api-hook数据同步-数据库-缓存-用户"}},[e._v("#")]),e._v(" API Hook数据同步（数据库+缓存 ->用户）")]),e._v(" "),s("p",[e._v("用户查询parse库后返回过程中，DG-IOT自动同步ets缓存中的实时状态数据，解决状态不同步问题，")])])}),[],!1,null,null,null);a.default=r.exports}}]);