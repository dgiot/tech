(window.webpackJsonp=window.webpackJsonp||[]).push([[131],{771:function(t,s,a){"use strict";a.r(s);var e=a(10),n=Object(e.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"jt-t808-协议网关"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#jt-t808-协议网关"}},[t._v("#")]),t._v(" JT/T808 协议网关")]),t._v(" "),a("h2",{attrs:{id:"协议介绍"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#协议介绍"}},[t._v("#")]),t._v(" 协议介绍")]),t._v(" "),a("p",[a("strong",[t._v("emqx-jt808")]),t._v(" 做为 emqx 的接入网关，按照其功能逻辑和整个系统的关系，将整个消息交换的过程可以分成三个部分：终端侧，平台侧和其它侧：")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("|<-- Terminal --\x3e|<---------- Broker Side ----------\x3e|<---  Others  ---\x3e|\n|<-    Side    ->|                                   |<--    Side    --\x3e|\n\n+---+                                                  PUB  +-----------+\n| D |  INCOMING  +------------+    PUB     +---------+   --\x3e| subscriber|\n| E |-----------\x3e|            |-----------\x3e|         |--/   +-----------+\n| V |            | emqx-jt808 |            |  EMQ X  |\n| I |<-----------|            |<-----------|         |<--   +-----------+\n| C |  OUTGOING  +------------+    PUB     +---------+   \\--| publisher |\n| E |                                                  PUB  +-----------+\n+---+\n")])])]),a("ol",[a("li",[t._v("终端侧：通过 JT/T 808 协议进行交换数据，实现不同类型的数据的上报，或者发送下行的消息到终端。")]),t._v(" "),a("li",[t._v("平台侧：emqx-jt808 将报文解码后执行 注册/鉴权、或将数据报文 PUBLISH 到特定的主题上；代理订阅下行主题，将下行的 PUBLISH 消息转化为 JT/T 808 协议的报文结构，下发到终端。")]),t._v(" "),a("li",[t._v("其它侧，可以对 2 中出现的上行的 PUBLISH 消息的主题进行订阅，以接收上行消息。或对发布消息到具体的下行的主题，以发送数据到终端侧。")])]),t._v(" "),a("h2",{attrs:{id:"创建模块"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#创建模块"}},[t._v("#")]),t._v(" 创建模块")]),t._v(" "),a("p",[t._v("打开 "),a("a",{attrs:{href:"http://127.0.0.1:18083/#/modules",target:"_blank",rel:"noopener noreferrer"}},[t._v("EMQ X Dashboard"),a("OutboundLink")],1),t._v("，点击左侧的 “模块” 选项卡，选择添加：")]),t._v(" "),a("p",[a("img",{attrs:{src:"http://dgiot-1253666439.cos.ap-shanghai-fsi.myqcloud.com/develop_png/zh_CN/modules/assets/modules.png",alt:"modules.png"}})]),t._v(" "),a("p",[t._v("选择 JT/T808 协议接入网关:")]),t._v(" "),a("p",[a("img",{attrs:{src:"http://dgiot-1253666439.cos.ap-shanghai-fsi.myqcloud.com/develop_png/zh_CN/modules/assets/proto_jt8081.png",alt:"proto_jt8081.png"}})]),t._v(" "),a("p",[t._v("配置相关基础参数:")]),t._v(" "),a("p",[a("img",{attrs:{src:"http://dgiot-1253666439.cos.ap-shanghai-fsi.myqcloud.com/develop_png/zh_CN/modules/assets/proto_jt8082.png",alt:"proto_jt8082.png"}})]),t._v(" "),a("p",[t._v("添加监听端口:")]),t._v(" "),a("p",[a("img",{attrs:{src:"http://dgiot-1253666439.cos.ap-shanghai-fsi.myqcloud.com/develop_png/zh_CN/modules/assets/proto_jt8083.png",alt:"proto_jt8083.png"}})]),t._v(" "),a("p",[t._v("配置监听参数:")]),t._v(" "),a("p",[a("img",{attrs:{src:"http://dgiot-1253666439.cos.ap-shanghai-fsi.myqcloud.com/develop_png/zh_CN/modules/assets/proto_jt8084.png",alt:"proto_jt8084.png"}})]),t._v(" "),a("p",[t._v("点击确认到配置参数页面:")]),t._v(" "),a("p",[a("img",{attrs:{src:"http://dgiot-1253666439.cos.ap-shanghai-fsi.myqcloud.com/develop_png/zh_CN/modules/assets/proto_jt8085.png",alt:"proto_jt8085.png"}})]),t._v(" "),a("p",[t._v("点击添加后，模块添加完成:\n"),a("img",{attrs:{src:"http://dgiot-1253666439.cos.ap-shanghai-fsi.myqcloud.com/develop_png/zh_CN/modules/assets/proto_jt8086.png",alt:"proto_jt8086.png"}})]),t._v(" "),a("p",[a("strong",[t._v("emqx-jt808 实现规定：")])]),t._v(" "),a("ul",[a("li",[t._v("系统内以手机号作为一个连接的唯一标识，即 ClientId")])]),t._v(" "),a("h3",{attrs:{id:"配置参数"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#配置参数"}},[t._v("#")]),t._v(" 配置参数")]),t._v(" "),a("p",[t._v("emqx-jt808 的实现支持匿名的方式接入认证：")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("配置项")]),t._v(" "),a("th",[t._v("说明")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[t._v("允许匿名登录")]),t._v(" "),a("td",[t._v("是否允许匿名用户登录")])]),t._v(" "),a("tr",[a("td",[t._v("注册服务地址")]),t._v(" "),a("td",[t._v("JT/T808 终端注册的 HTTP 接口地址")])]),t._v(" "),a("tr",[a("td",[t._v("认证服务地址")]),t._v(" "),a("td",[t._v("JT/T808 终端接入鉴权的 HTTP 接口地址")])]),t._v(" "),a("tr",[a("td",[t._v("下行消息主题格式")]),t._v(" "),a("td",[t._v("上行主题。上行消息到 EMQ X 系统中的消息主题%c: 接入客户端的 ClientId,%p: 接入客户端的 Phone")])]),t._v(" "),a("tr",[a("td",[t._v("上行消息主题格式")]),t._v(" "),a("td",[t._v("下行主题。上行消息到 EMQ X 系统中的消息主题%c: 接入客户端的 ClientId,%p: 接入客户端的 Phone")])]),t._v(" "),a("tr",[a("td",[t._v("允许最大报文长度")]),t._v(" "),a("td",[t._v("最大处理的单个JT/T808协议报文大小")])])])]),t._v(" "),a("h3",{attrs:{id:"注册及鉴权"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#注册及鉴权"}},[t._v("#")]),t._v(" 注册及鉴权")]),t._v(" "),a("p",[t._v("注册请求详细格式如下：")]),t._v(" "),a("p",[a("strong",[t._v("注册请求：")])]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v('    URL: http://127.0.0.1:8991/jt808/registry\n    Method: POST\n    Body:\n       { "province": 58,\n         "city": 59,\n         "manufacturer": "Infinity",\n         "model": "Q2",\n         "license_number": "ZA334455",\n         "dev_id": "xx11344",\n         "color": 3,\n         "phone", "00123456789"\n       }\n')])])]),a("p",[a("strong",[t._v("注册应答：")])]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v('{\n  "code": 0,\n  "authcode": "132456789"\n}\n\n或:\n\n{\n  "code": 1\n}\n\n其中返回码可以为：\n\n0: 成功\n1: 车辆已被注册\n2: 数据库中无该车辆\n3: 终端已被注册\n4: 数据库中无该终端\n')])])]),a("p",[a("strong",[t._v("鉴权请求：")])]),t._v(" "),a("div",{staticClass:"language-properties extra-class"},[a("pre",{pre:!0,attrs:{class:"language-properties"}},[a("code",[a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("    URL")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("http://127.0.0.1:8991/jt808/auth")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("    Method")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("POST")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("    Body")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("       {")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v('"code": "authcode",')]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v('         "phone",')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v('"00123456789"')]),t._v("\n       }\n")])])]),a("p",[a("strong",[t._v("鉴权应答：")])]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("HTTP 状态码 200: 鉴权成功\n其他: 鉴权失败\n")])])]),a("p",[t._v("注：鉴权请求只会在系统未保存鉴权码时调用（即终端直接发送鉴权报文进行登录系统）")]),t._v(" "),a("h3",{attrs:{id:"数据上下行"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#数据上下行"}},[t._v("#")]),t._v(" 数据上下行")]),t._v(" "),a("p",[t._v("emqx-jt808 中通过配置上下行主题来收发终端消息：")]),t._v(" "),a("h4",{attrs:{id:"上行"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#上行"}},[t._v("#")]),t._v(" 上行")]),t._v(" "),a("p",[t._v("例如："),a("strong",[t._v("制造商Id")]),t._v(" 为 "),a("code",[t._v("abcde")]),t._v(" 和 "),a("strong",[t._v("终端Id")]),t._v(" 为 "),a("code",[t._v("1234567")]),t._v(" 的设备。")]),t._v(" "),a("p",[t._v("首先先使用 MQTT 客户端订阅主题 "),a("code",[t._v("jt808/abcde1234567/up")]),t._v("：")]),t._v(" "),a("div",{staticClass:"language-properties extra-class"},[a("pre",{pre:!0,attrs:{class:"language-properties"}},[a("code",[a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("$")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("mosquitto_sub -t jt808/abcde1234567/up")]),t._v("\n")])])]),a("p",[t._v("例如终端在上报 "),a("code",[t._v("数据上行透传(0x0900)")]),t._v(" 类型的消息后，订阅端会收到：")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"body"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"data"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"MTIzNDU2"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"type"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("240")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"header"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("\n     "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"encrypt"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n       "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"len"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("7")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n       "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"msg_id"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2304")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n       "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"msg_sn"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("4")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n       "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"phone"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"011111111111"')]),t._v("\n     "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[t._v("注：透明传输类，data 域的内容会 base64 编码一次在上报出来")]),t._v(" "),a("h4",{attrs:{id:"数据下行"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#数据下行"}},[t._v("#")]),t._v(" 数据下行")]),t._v(" "),a("p",[t._v("同样，以上行的ID为例；在终端鉴权成功后，使用 MQTT 客户端向该终端下发一个 '数据下行透传(0x8900)' 类型的消息：")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v('$ mosquitto_pub -t jt808/abcde1234567/dn -m \'{"body":{"data":"MTIzNDU2","type":240},"header":{"msg_id":35072}}\'\n')])])]),a("p",[t._v("注：下行 JSON 中，header 中的内容只需要带 msg_id 即可；body 中的内容根据不同的 msg_id 有不同的结构")])])}),[],!1,null,null,null);s.default=n.exports}}]);