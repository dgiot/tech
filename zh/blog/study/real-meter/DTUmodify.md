# DTU调试

## 第一部分:

由于采用的电表拥有自带的通讯信息,所以对于电表的波特率、校验码奇偶和校验位个数等方面都要进行一个测试来得到其具体数据.
否则无法与DTU之间建立通讯来完成抄表任务.由此我们有两个办法来获得上述数据:1.查看厂商提供的资料或者询问获得;
2.测试各个常见的数据查看是否能完成连接后通讯.经测试,我们得到该DDZY1296型电表的波特率为'2400',数据位'8',
停止位为'1',校验为'偶EVEN'.

*建议*:对第一部分实现了但把握不大的人员,我建议理解一下第二部分的内容再按照第三部分内容进行操作.
当然对整个模型框架有概念的挑战者在配置完第二部分后便可进入下一步操作.

## 第二部分:
DTU调试分3个方面.指的是网络配置、MCU配置和服务器信息配置.对于W610而言,我们将在网页上面对它进行信息变更.

1.*网络配置*:此步骤以建立DTU连接网络为目的.点击DTU进行无线网络进行设置.将要连的wifi用户和密码输入到指定位置.
设置完后若要点确认的因在完成每一次更改后都点一次,否则信息不会保存.

**确保网络配置连接已完成更改后,去模式一栏将AP改为STA模式.即变为静态连接关闭原有的热点模式**

2.*MCU配置*:此步骤以建立电表和DTU之间的通讯为目的.我们根据第一部分得到电表485口通讯的信息进行修改.
并选择设备上报注册包信息为MAC地址,方便设备自动上线后我们的检查.最后确认DTU不会上报有些没必要的信息.
修改信息如下图所示:

 

3.*服务器信息配置*:此步骤以建立DTU与服务器数据库连接为目的.先将我们的DTU设置为clience模式去连接服务器,
后将服务器地址和将要接收信息的端口号填入即可.如图示:

 

完成上述步骤后有把握的可以进入下一步骤,个人而言希望大家可以阅读一下第三部分.

--------

## 第三部分

对于上述配置准确性没有把握或后续发生错误来排除故障,以及想测试DTU和设备是否适配的人员,我们可以通过透传来检测dtu
和电表以及服务器间的连接是否正常.

初步了解DTU各个配置目的后,用debug的方法进行操作.大致意思为将设备先用本地服务器测试无误后移植远程服务器中,
可以尽可能排除有些问题.那么首先我们将MCU配置好,网络连到与电脑同一个路由器下,*服务器地址写为本机地址*.然后开启一个
TPC server进行简单设置将DTU连上来,此时我们可以向DTU发生消息查看其是否响应请求和返回值是否正确.下发的指令为
```68 AA AA AA AA AA AA 68 11 04 33 33 33 33 AD 16 ``` 
(此码含义为'查看当前组合有功电能'.想要了解或有疑义可参考'常见错误解决和扩展'-->'抄表软件')若正常配置,
我们会收到来自DTU对电表信息的返回值.那么我们就可以切换到DTU所在网址(参考TCP server),
进入后将服务器地址和端口号换成服务器的值,然后进行下一阶段的操作.

如果上述连接出现了错误,分析一下目前可能会出错的地方:1.MCU配置不正确;2.网络配置出错;3.DTU与电表设备不匹配;
4.发送的指令格式不对或间隔太短......

