(window.webpackJsonp=window.webpackJsonp||[]).push([[119],{685:function(s,t,n){"use strict";n.r(t);var a=n(9),e=Object(a.a)({},(function(){var s=this,t=s.$createElement,n=s._self._c||t;return n("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[n("h1",{attrs:{id:"会话"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#会话"}},[s._v("#")]),s._v(" 会话")]),s._v(" "),n("p",[s._v("会话表示已登录用户的的实例，会话会在用户注册或登录时自动创建，也会在用户注销时自动删除。每个用户都有一个独特的"),n("code",[s._v("Session")]),s._v("，如果用户从一个已登录设备发起一个登录请求，那么用户原本的"),n("code",[s._v("Session")]),s._v("就会被自动覆盖。"),n("code",[s._v("Session")]),s._v("对象被存储在Parse的"),n("code",[s._v("Session")]),s._v("类中，你可以在Parse.com的数据浏览器上看到他们，我们提供了相应的API集合为你在应用中管理"),n("code",[s._v("Session")]),s._v("。")]),s._v(" "),n("p",[n("code",[s._v("Session")]),s._v("是Parse "),n("code",[s._v("Object")]),s._v("的子类，所以你可以像处理其他Parse对象一样查询、更新、删除"),n("code",[s._v("Session")]),s._v("。当你注册或登录用户时，Parse云端会自动创建session，你不需要手动的创建"),n("code",[s._v("Session")]),s._v("对象。删除"),n("code",[s._v("Session")]),s._v("会造成当前设备上使用此session的用户被注销。")]),s._v(" "),n("p",[s._v("不同于其他的Parse对象，"),n("code",[s._v("Session")]),s._v("类在云代码中没有触发器，所以你不需要为"),n("code",[s._v("Session")]),s._v("类注册"),n("code",[s._v("beforeSave")]),s._v("或"),n("code",[s._v("afterSave")]),s._v("。")]),s._v(" "),n("hr"),s._v(" "),n("h2",{attrs:{id:"会话属性"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#会话属性"}},[s._v("#")]),s._v(" 会话属性")]),s._v(" "),n("p",[n("code",[s._v("Session")]),s._v("对象具有下面这些字段：")]),s._v(" "),n("ul",[n("li",[n("p",[n("code",[s._v("sessionToken")]),s._v("（只读）：用于验证Parse API请求的字符串标识，在请求的相应结果中，只有当前"),n("code",[s._v("Session")]),s._v("对象包含"),n("code",[s._v("sessionToken")]),s._v("。")])]),s._v(" "),n("li",[n("p",[n("code",[s._v("user")]),s._v("（只读）：指向所属的用户对象")])]),s._v(" "),n("li",[n("p",[n("code",[s._v("createdWith")]),s._v("（只读）：关于session是如何创建的信息（e.g "),n("code",[s._v('{ "action": "login", "authProvider": "password"}')]),s._v("）。")]),s._v(" "),n("ul",[n("li",[n("code",[s._v("action")]),s._v("可能的值有："),n("code",[s._v("login")]),s._v("，"),n("code",[s._v("signup")]),s._v("，"),n("code",[s._v("create")]),s._v("，"),n("code",[s._v("upgrade")]),s._v("。当保存的"),n("code",[s._v("Session")]),s._v("对象是开发者手动创建的，值就会是"),n("code",[s._v("create")]),s._v("；当用户从旧的"),n("code",[s._v("sessionToken")]),s._v("更新到新的"),n("code",[s._v("sessionToken")]),s._v("，值就会是"),n("code",[s._v("upgrade")]),s._v("。")]),s._v(" "),n("li",[n("code",[s._v("authProvider")]),s._v(" 可能的值有，"),n("code",[s._v("password")]),s._v("，"),n("code",[s._v("anonymous")]),s._v("，"),n("code",[s._v("facebook")]),s._v("，"),n("code",[s._v("twitter")]),s._v("。")])])]),s._v(" "),n("li",[n("p",[n("code",[s._v("restricted")]),s._v("（只读）：表示session是否受限制。")]),s._v(" "),n("ul",[n("li",[s._v("受限制session对Parse上的"),n("code",[s._v("User")]),s._v("、"),n("code",[s._v("Session")]),s._v("、"),n("code",[s._v("Role")]),s._v("没有写权限，受限制的会话也不能读取未受限制的会话。")]),s._v(" "),n("li",[s._v("通过用户注册或登录，由Parse云端自动创建的session，全都是未受限制的；由开发者通过客户端手段创建保存的new "),n("code",[s._v("Session")]),s._v("对象，都是受限制的。")])])]),s._v(" "),n("li",[n("p",[n("code",[s._v("expiresAt")]),s._v("（只读）："),n("code",[s._v("Session")]),s._v("对象将被自动删除的日期（UTC），你可以在你应用的Parse面板设置页面进行设置（一年不活动过期或永不过期）。")])]),s._v(" "),n("li",[n("p",[n("code",[s._v("installationId")]),s._v("（只能设置一次）：表示会话从哪里登录。对于Parse SDK，这个字段会在用户注册或登录时自动设置。除了"),n("code",[s._v("installationId")]),s._v("，所有的字段只能由Parse云端自动设置。但请记住，所有已登录设备都可以读取相同用户的其他session，除非你禁用表级权限。")])])]),s._v(" "),n("hr"),s._v(" "),n("h2",{attrs:{id:"处理无效的session-token"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#处理无效的session-token"}},[s._v("#")]),s._v(" 处理无效的session token")]),s._v(" "),n("p",[s._v("使用可撤回session，如果你的"),n("code",[s._v("Session")]),s._v("对象被Parse云端删除了，那么你对应的当前用户session也会失效，这在某些情况下可能会用上，比如你从用户"),n("code",[s._v("Session")]),s._v("管理界面上，将用户强制注销，或者你手动的从云端删除了session。")]),s._v(" "),n("p",[s._v("session还可以通过设置自动过期来自动删除。 如果一个设备上的session token无法和Parse云端匹配上，那么所有来自此设备的请求都将返回错误信息：“Error 209: invalid session token”。")]),s._v(" "),n("p",[s._v("要处理这个错误，我们推荐写一个全局的功能函数，并在你的Parse请求发生错误时调用，然后你就可以在全局函数中处理无效“invalid session token”。同时你应该提示用户重新登录，这样用户就能获得新的session token。像这样：")]),s._v(" "),n("div",{staticClass:"language-js extra-class"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("function")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("handleParseError")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token parameter"}},[s._v("err")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("switch")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("err"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("code"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("case")]),s._v(" Parse"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("Error"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("INVALID_SESSION_TOKEN")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n      Parse"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("User"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("logOut")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("...")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 提示用户重新登录")]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("...")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// If Express.js, redirect the user to the log in route")]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("break")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("...")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// Other Parse API errors that you want to explicitly handle")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 为所有api请求的报错调用全局错误处理方法")]),s._v("\nquery"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("find")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("then")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("function")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("...")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("function")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token parameter"}},[s._v("err")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("handleParseError")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("err"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])]),n("hr"),s._v(" "),n("h2",{attrs:{id:"会话安全"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#会话安全"}},[s._v("#")]),s._v(" 会话安全")]),s._v(" "),n("p",[n("code",[s._v("Session")]),s._v("对象只有user字段指定的用户可以访问，所有的"),n("code",[s._v("Session")]),s._v("对象都有一个ACL，只允许指定用户读写，你不能修改这个ACL。这意味着会话的查询只会返回与当前登录用户相匹配的会话。")]),s._v(" "),n("p",[s._v("当你使用login方法登录时，Parse云端将会自动创建一个未受限制的"),n("code",[s._v("Session")]),s._v("对象，使用signup、脸书、推特登录也是一样。")]),s._v(" "),n("p",[s._v("通过客户端SDK手动创建的"),n("code",[s._v("Session")]),s._v("对象始终是受限制的，你不能使用api手动创建一个未受限制的会话。")]),s._v(" "),n("p",[s._v("受限制的会话禁止创建、修改、更新"),n("code",[s._v("User")]),s._v("、"),n("code",[s._v("Session")]),s._v("、"),n("code",[s._v("Role")]),s._v("中的任何数据，受限制的会话也不能读取未受限制的会话。受限制的会话在“Parse for IoT”设备（例如 Arduino、Embedded C）中很有用，这在不可信的物理环境用的也比手机应用环境用的多。无论如何，记住受限制的会话仍然可以读取"),n("code",[s._v("User")]),s._v("、"),n("code",[s._v("Session")]),s._v("、"),n("code",[s._v("Role")]),s._v("类中的数据，并且可以像正常session一样读写其他class中的任何数据。这对IoT设备的安全和加密存储仍然非常重要。")]),s._v(" "),n("p",[s._v("如果你想阻止受限制会话修改"),n("code",[s._v("User")]),s._v("、"),n("code",[s._v("Session")]),s._v("、"),n("code",[s._v("Role")]),s._v("以外的class，你可以为在云代码中为其class写一个"),n("code",[s._v("beforeSave")]),s._v("处理器：")]),s._v(" "),n("div",{staticClass:"language-js extra-class"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[s._v("Parse"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("Cloud"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("beforeSave")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"MyClass"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("function")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token parameter"}},[s._v("request"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" response")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  Parse"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("Session"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("current")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("then")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("function")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token parameter"}},[s._v("session")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("session"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("get")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'restricted'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n      response"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("error")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'禁止写操作'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    response"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("success")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])]),n("p",[s._v("如果你想在Parse上为"),n("code",[s._v("Session")]),s._v("表设置表级权限（CLP），以限制session的读写，但不要在用户注册、登录、注销时限制Parse云自动增删session。我们推荐你禁用"),n("code",[s._v("Session")]),s._v("所有不需要的CLP。下面有一些"),n("code",[s._v("Session")]),s._v(" CLP的用例：")]),s._v(" "),n("ul",[n("li",[n("strong",[s._v("Find、Delete")]),s._v(" - 用以构建一个供用户查看其他登录的在线设备，并且注销其他设备的用户.的功能。如果你不需要个功能，你应该禁用这个权限。")]),s._v(" "),n("li",[s._v("**Create **- 用于“Parse for IoT”应用，如果是的app是手机应用或web应用，如果你的IoT设备不需要用户会话，你应该禁用这个权限。")]),s._v(" "),n("li",[n("strong",[s._v("Get、Update、Add Field")]),s._v(" - 除非你需要这些操作，否则你应该禁用这些权限。")])])])}),[],!1,null,null,null);t.default=e.exports}}]);